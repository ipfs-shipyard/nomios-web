(window.webpackJsonp=window.webpackJsonp||[]).push([[1],{1345:function(e,t){},1420:function(e,t){},1434:function(e,t){},1435:function(e,t){},1494:function(e,t){},1605:function(e,t){},1607:function(e,t){},1856:function(e,t){},1869:function(e,t){},1963:function(e,t){},1965:function(e,t){},2058:function(e,t){},2089:function(e,t){},2096:function(e,t){},2098:function(e,t){},2252:function(e,t){},2346:function(e,t){},2358:function(e,t){},2388:function(e,t){},2591:function(e,t){},2593:function(e,t){},2610:function(e,t){},2717:function(e,t){},2718:function(e,t){},2729:function(e,t){},3064:function(e,t,n){"use strict";n.r(t);var r=n(5),a=n.n(r),i=n(8),c=n(11),s=n(1755),u=n.n(s),o=n(6),p=n(10),l=n(1053),h=n(2380),f=n.n(h),v=function(e){return crypto.getRandomValues(new Uint8Array(e))},d=n(1224),w=n.n(d),b=n(13),y=n(9),k=n(12),O=n(4),x=n(166),g=function(e){function t(e,n,r){var a;return Object(o.a)(this,t),a=Object(b.a)(this,Object(y.a)(t).call(this,e)),Object.assign(Object(O.a)(a),Object(i.a)({},r,{code:n,name:a.constructor.name})),Error.captureStackTrace?(Error.captureStackTrace(Object(O.a)(a),a.constructor),Object(b.a)(a)):(a.stack=new Error(e).stack,a)}return Object(k.a)(t,e),t}(Object(x.a)(Error)),m=function(e){function t(e){return Object(o.a)(this,t),Object(b.a)(this,Object(y.a)(t).call(this,"Unsupported cypher algorithm: ".concat(e),"UNSUPPORTED_CYPHER_ALGORITHM"))}return Object(k.a)(t,e),t}(g),j=function(e){return Object(i.a)({},e,{cypherText:w.a.toString(e.cypherText,{uppercase:!1}),iv:w.a.toString(e.iv,{uppercase:!1})})},E=function(e){return Object(i.a)({},e,{cypherText:w.a.fromString(e.cypherText),iv:w.a.fromString(e.iv)})},M=function(){var e=Object(c.a)(a.a.mark(function e(t,n){var r,i,c,s,u,o,p=arguments;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=p.length>2&&void 0!==p[2]&&p[2],i="AES-GCM",c=v(12),e.next=5,crypto.subtle.importKey("raw",n,i,!1,["encrypt"]);case 5:return s=e.sent,e.next=8,crypto.subtle.encrypt({name:i,iv:c},s,t);case 8:return u=e.sent,o={algorithm:"AES-GCM",cypherText:new Uint8Array(u),iv:c},r&&(o=j(o)),e.abrupt("return",o);case 12:case"end":return e.stop()}},e)}));return function(t,n){return e.apply(this,arguments)}}(),T=function(){var e=Object(c.a)(a.a.mark(function e(t,n){var r,i,c,s,u,o;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"===typeof t.cypherText&&(t=E(t)),i=(r=t).algorithm,c=r.cypherText,s=r.iv,"AES-GCM"===i){e.next=4;break}throw new m(i);case 4:return e.next=6,crypto.subtle.importKey("raw",n,i,!1,["decrypt"]);case 6:return u=e.sent,e.next=9,crypto.subtle.decrypt({name:i,iv:s},u,c);case 9:return o=e.sent,e.abrupt("return",new Uint8Array(o));case 11:case"end":return e.stop()}},e)}));return function(t,n){return e.apply(this,arguments)}}(),A=function(e){return Boolean(e&&e.algorithm&&e.cypherText&&e.iv)},I=function(){var e=Object(c.a)(a.a.mark(function e(t,n){var r,i,c,s=arguments;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=s.length>2&&void 0!==s[2]&&s[2],"string"===typeof t&&(t=new TextEncoder("utf-8").encode(t)),e.next=4,crypto.subtle.digest("SHA-256",t);case 4:return i=e.sent,c=new Uint8Array(i),r&&(c=w.a.toString(c,{uppercase:!1})),e.abrupt("return",c);case 8:case"end":return e.stop()}},e)}));return function(t,n){return e.apply(this,arguments)}}(),D=function(e,t){return I(e,"SHA-256",t)},W=n(2381),S=n.n(W),_=n(54),P=n(1225),R=n.n(P),N=n(1588),C=n.n(N),K=n(1249),L=function(e){return new Uint8Array(e.buffer.slice(e.byteOffset,e.byteOffset+e.byteLength))},U=function(e){if(4!==e[0])throw new Error("Only uncompressed EC points are supported");if(65!==e.length)throw new Error("Expecting EC public key to have length ".concat(63));return{x:e.slice(1,33),y:e.slice(33)}},V=function(e){var t=e.privateKey,n=e.publicKey,r=R.a.publicKeyConvert(n,!1),a=L(t),i=U(L(r)),c=i.x,s=i.y;return Object(K.a)({format:"raw-pem",keyAlgorithm:{id:"ec-public-key",namedCurve:"secp256k1"},keyData:{d:a,x:c,y:s}})},Y=function(e){var t=e.publicKey,n=R.a.publicKeyConvert(t,!1),r=U(L(n)),a=r.x,i=r.y;return Object(K.b)({format:"spki-pem",keyAlgorithm:{id:"ec-public-key",namedCurve:"secp256k1"},keyData:{x:a,y:i}})},B=function(){var e=v(64),t=C.a.fromMasterSeed(_.Buffer.from(e));return{privateKeyPem:V(t),publicKeyPem:Y(t),privateExtendedKeyBase58:t.privateExtendedKey,publicExtendedKeyBase58:t.publicExtendedKey}},H=function(e){var t=C.a.fromExtendedKey(e),n=S()(0,Math.pow(2,31)-1),r="m/".concat(n),a=t.derive(r);return{privateKeyPem:V(a),publicKeyPem:Y(a),keyPath:r}},F=function(e){function t(e){return Object(o.a)(this,t),Object(b.a)(this,Object(y.a)(t).call(this,"Did method `".concat(e,"` is not supported"),"UNSUPPORTED_DID_METHOD"))}return Object(k.a)(t,e),t}(g),G=function(e){function t(e,n){return Object(o.a)(this,t),Object(b.a)(this,Object(y.a)(t).call(this,"Purpose `".concat(n,"` is not currently supported for `").concat(e,"`"),"UNSUPPORTED_DID_METHOD_PURPOSE"))}return Object(k.a)(t,e),t}(g),J=function(e){function t(e){return Object(o.a)(this,t),Object(b.a)(this,Object(y.a)(t).call(this,e,"MISSING_DID_PARAMETERS"))}return Object(k.a)(t,e),t}(g),X=function(e){function t(e,n){return Object(o.a)(this,t),Object(b.a)(this,Object(y.a)(t).call(this,"Invalid profile ".concat(e,": ").concat(n),"INVALID_PROFILE_PROPERTY"))}return Object(k.a)(t,e),t}(g),q=function(e){function t(e){return Object(o.a)(this,t),Object(b.a)(this,Object(y.a)(t).call(this,"Invalid operation with mandatory profile property: ".concat(e),"INVALID_OPERATION_MANADATORY_PROPERTY"))}return Object(k.a)(t,e),t}(g),z=function(e){function t(e){return Object(o.a)(this,t),Object(b.a)(this,Object(y.a)(t).call(this,"Property ".concat(e," is not supported"),"UNSUPPORTED_PROFILE_PROPERTY"))}return Object(k.a)(t,e),t}(g),Q=function(e){function t(){return Object(o.a)(this,t),Object(b.a)(this,Object(y.a)(t).call(this,"Profile replication timed out","PROFILE_REPLICATION_TIMEOUT"))}return Object(k.a)(t,e),t}(g),Z=function(e){function t(e,n){return Object(o.a)(this,t),Object(b.a)(this,Object(y.a)(t).call(this,'Expecting infura response hash to be "'.concat(n,'" but got "').concat(e," instead"),"INFURA_HASH_MISMATCH"))}return Object(k.a)(t,e),t}(g),$=function(e){function t(e,n){return Object(o.a)(this,t),Object(b.a)(this,Object(y.a)(t).call(this,"Invalid device ".concat(e,": ").concat(n),"INVALID_DEVICE_PROPERTY"))}return Object(k.a)(t,e),t}(g),ee=function(e){function t(e){return Object(o.a)(this,t),Object(b.a)(this,Object(y.a)(t).call(this,"Unknown device with id: ".concat(e),"UNKNOWN_DEVICE"))}return Object(k.a)(t,e),t}(g),te=function(e){function t(e){return Object(o.a)(this,t),Object(b.a)(this,Object(y.a)(t).call(this,e,"INVALID_DEVICE_OPERATION"))}return Object(k.a)(t,e),t}(g),ne=function(e){function t(e){return Object(o.a)(this,t),Object(b.a)(this,Object(y.a)(t).call(this,"Property ".concat(e," is not supported"),"UNSUPPORTED_DEVICE_INFO_PROPERTY"))}return Object(k.a)(t,e),t}(g),re=function(e){function t(e){return Object(o.a)(this,t),Object(b.a)(this,Object(y.a)(t).call(this,"Unknown app with id: ".concat(e),"UNKNOWN_APPLICAITON"))}return Object(k.a)(t,e),t}(g),ae=function(e){function t(e,n){return Object(o.a)(this,t),Object(b.a)(this,Object(y.a)(t).call(this,"Invalid application ".concat(e,": ").concat(n),"INVALID_APPLICATION_PROPERTY"))}return Object(k.a)(t,e),t}(g),ie=function(e){function t(e){return Object(o.a)(this,t),Object(b.a)(this,Object(y.a)(t).call(this,e,"IDENTITY_REVOKED"))}return Object(k.a)(t,e),t}(g),ce=function(e){function t(){return Object(o.a)(this,t),Object(b.a)(this,Object(y.a)(t).call(this,"Identites are still not loaded","IDENTITIES_NOT_LOADED"))}return Object(k.a)(t,e),t}(g),se=function(e){function t(e){return Object(o.a)(this,t),Object(b.a)(this,Object(y.a)(t).call(this,"Unknown identity with: ".concat(e),"UNKNOWN_IDENTITY"))}return Object(k.a)(t,e),t}(g),ue=function(e){function t(e){return Object(o.a)(this,t),Object(b.a)(this,Object(y.a)(t).call(this,"Identity with the following did already exists: ".concat(e),"IDENTITY_ALREADY_EXISTS"))}return Object(k.a)(t,e),t}(g),oe=function(e){function t(e,n){return Object(o.a)(this,t),e=e||"Lock validation unsuccessful",Object(b.a)(this,Object(y.a)(t).call(this,e,"LOCK_VALIDATION",n))}return Object(k.a)(t,e),t}(g),pe=function(e){function t(e){return Object(o.a)(this,t),e=e||"Provided input is invalid",Object(b.a)(this,Object(y.a)(t).call(this,e,"UNLOCK_INPUT_MISMATCH"))}return Object(k.a)(t,e),t}(g),le=function(e){function t(){return Object(o.a)(this,t),Object(b.a)(this,Object(y.a)(t).call(this,"Lock must be disabled","LOCK_NOT_DISABLED"))}return Object(k.a)(t,e),t}(g),he=function(e){function t(){return Object(o.a)(this,t),Object(b.a)(this,Object(y.a)(t).call(this,"Lock must be enabled","LOCK_NOT_ENABLED"))}return Object(k.a)(t,e),t}(g),fe=function(e){function t(){return Object(o.a)(this,t),Object(b.a)(this,Object(y.a)(t).call(this,"Locker is locked","LOCKED"))}return Object(k.a)(t,e),t}(g),ve=function(e){function t(){return Object(o.a)(this,t),Object(b.a)(this,Object(y.a)(t).call(this,"Can't lock until you configure the master lock","IS_PRISTINE"))}return Object(k.a)(t,e),t}(g),de=function(e){function t(e){return Object(o.a)(this,t),Object(b.a)(this,Object(y.a)(t).call(this,"There's no lock of type `".concat(e,"`"),"UNKNOWN_LOCK_TYPE"))}return Object(k.a)(t,e),t}(g),we=function(e){function t(e,n,r){return Object(o.a)(this,t),e=e||"Something went wrong during storage operations",Object(b.a)(this,Object(y.a)(t).call(this,e,"STORAGE_OPERATION",{operation:n,type:r}))}return Object(k.a)(t,e),t}(g),be=function(e){function t(){return Object(o.a)(this,t),Object(b.a)(this,Object(y.a)(t).call(this,"Session options must be a plain object","INVALID_SESSION_OPTIONS"))}return Object(k.a)(t,e),t}(g),ye=function(e){function t(e){return Object(o.a)(this,t),Object(b.a)(this,Object(y.a)(t).call(this,"Unknown session with: ".concat(e),"UNKNOWN_SESSION"))}return Object(k.a)(t,e),t}(g),ke=function(e){function t(){return Object(o.a)(this,t),Object(b.a)(this,Object(y.a)(t).call(this,"IPFS node is unavailable","IPFS_UNAVAILABLE"))}return Object(k.a)(t,e),t}(g),Oe=function(e){function t(){return Object(o.a)(this,t),Object(b.a)(this,Object(y.a)(t).call(this,"Invalid master lock operation","INVALID_MASTER_OPERATION"))}return Object(k.a)(t,e),t}(g);function xe(e,t){if(!t.has(e))throw new TypeError("attempted to get private field on non-instance");var n=t.get(e);return n.get?n.get.call(e):n.value}function ge(e,t,n){if(!t.has(e))throw new TypeError("attempted to set private field on non-instance");var r=t.get(e);if(r.set)r.set.call(e,n);else{if(!r.writable)throw new TypeError("attempted to set read only private field");r.value=n}return n}var me=function(){function e(t){Object(o.a)(this,e),je.set(this,{writable:!0,value:void 0}),Ee.set(this,{writable:!0,value:void 0}),Me.set(this,{writable:!0,value:f()()}),Te.set(this,{writable:!0,value:Object(l.a)()}),ge(this,Ee,t||new fe)}return Object(p.a)(e,[{key:"has",value:function(){return null!=xe(this,je)}},{key:"get",value:function(){if(!xe(this,je))throw xe(this,Ee);return xe(this,je)}},{key:"getAsync",value:function(){var e=Object(c.a)(a.a.mark(function e(){return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,xe(this,Me).promise;case 2:return e.abrupt("return",xe(this,je));case 3:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"set",value:function(e){var t=!this.has();ge(this,je,e),xe(this,Me).resolve(),t&&xe(this,Te).dispatch(xe(this,je))}},{key:"unset",value:function(){this.has()&&(ge(this,je,null),ge(this,Me,f()()),xe(this,Te).dispatch(xe(this,je)))}},{key:"generate",value:function(){this.set(v(32))}},{key:"onDefinedChange",value:function(e){return xe(this,Te).add(e)}}]),e}(),je=new WeakMap,Ee=new WeakMap,Me=new WeakMap,Te=new WeakMap,Ae=function(e){return new me(e)},Ie=n(3021),De=n(3020);function We(e,t){if(!t.has(e))throw new TypeError("attempted to get private field on non-instance");var n=t.get(e);return n.get?n.get.call(e):n.value}function Se(e,t,n){if(!t.has(e))throw new TypeError("attempted to set private field on non-instance");var r=t.get(e);if(r.set)r.set.call(e,n);else{if(!r.writable)throw new TypeError("attempted to set read only private field");r.value=n}return n}var _e,Pe,Re,Ne=function(){function e(t){var n=this;Object(o.a)(this,e),Ce.set(this,{writable:!0,value:void 0}),Ke.set(this,{writable:!0,value:void 0}),Le.set(this,{writable:!0,value:function(){var e=Object(c.a)(a.a.mark(function e(){return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(We(n,Ce)){e.next=8;break}return e.t0=Se,e.t1=n,e.t2=Ce,e.next=6,Object(Ie.a)(We(n,Ke));case 6:e.t3=e.sent,(0,e.t0)(e.t1,e.t2,e.t3);case 8:case"end":return e.stop()}},e)}));return function(){return e.apply(this,arguments)}}()}),Ue.set(this,{writable:!0,value:function(){var e=Object(c.a)(a.a.mark(function e(t){var n,r,i,c,s,u,o,p,l;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r=(n=t||{}).privateKey,i=n.mnemonic,c=n.seed,s=n.algorithm,!r){e.next=3;break}return e.abrupt("return",r);case 3:if(!c){e.next=9;break}return e.next=6,Object(De.c)(c,s||"rsa");case 6:return u=e.sent,o=u.privateKey,e.abrupt("return",o);case 9:if(!i){e.next=15;break}return e.next=12,Object(De.b)(i,s||"rsa");case 12:return p=e.sent,l=p.privateKey,e.abrupt("return",l);case 15:throw new J("Please specify the privateKey, seed or mnemonic");case 16:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()}),Se(this,Ke,t)}return Object(p.a)(e,[{key:"getDid",value:function(){var e=Object(c.a)(a.a.mark(function e(t){var n;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,We(this,Ue).call(this,t);case 2:return n=e.sent,e.abrupt("return",Object(Ie.b)(n));case 4:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"resolve",value:function(){var e=Object(c.a)(a.a.mark(function e(t){return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,We(this,Le).call(this);case 2:return e.abrupt("return",We(this,Ce).resolve(t));case 3:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"create",value:function(){var e=Object(c.a)(a.a.mark(function e(t,n){var r,i;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(De.a)("rsa");case 2:return r=e.sent,e.next=5,We(this,Le).call(this);case 5:return e.next=7,We(this,Ce).create(r.privateKey,function(e){e.addPublicKey({id:"idm-master",type:"RsaVerificationKey2018",publicKeyPem:r.publicKey}),n(e)});case 7:return i=e.sent,e.abrupt("return",{did:i.id,didDocument:i,backupData:r});case 9:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}()},{key:"update",value:function(){var e=Object(c.a)(a.a.mark(function e(t,n,r){var i,c;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,We(this,Ue).call(this,n);case 2:return i=e.sent,e.next=5,We(this,Le).call(this);case 5:return e.next=7,We(this,Ce).update(i,r);case 7:return c=e.sent,e.abrupt("return",c);case 9:case"end":return e.stop()}},e,this)}));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"isPublicKeyValid",value:function(){var e=Object(c.a)(a.a.mark(function e(t,n){var r,i,c;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.resolve(t);case 2:return r=e.sent,i=r.publicKey,c=void 0===i?[]:i,e.abrupt("return",c.some(function(e){return e.id===n}));case 6:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}()}]),e}(),Ce=new WeakMap,Ke=new WeakMap,Le=new WeakMap,Ue=new WeakMap;Re={method:"ipid",description:"The Interplanetary Identifiers DID method (IPID) supports DIDs on the public and private Interplanetary File System (IPFS) networks.",homepageUrl:"https://did-ipid.github.io/ipid-did-method/",icons:[]},(Pe="info")in(_e=Ne)?Object.defineProperty(_e,Pe,{value:Re,enumerable:!0,configurable:!0,writable:!0}):_e[Pe]=Re;var Ve=function(e){return new Ne(e)},Ye=n(1354),Be=n.n(Ye),He=function(e){function t(e){return Object(o.a)(this,t),Object(b.a)(this,Object(y.a)(t).call(this,e,"INVALID_DID"))}return Object(k.a)(t,e),t}(g),Fe=function(e){function t(e){return Object(o.a)(this,t),Object(b.a)(this,Object(y.a)(t).call(this,e,"INVALID_DID_PARTS"))}return Object(k.a)(t,e),t}(g),Ge=function(e){var t;try{t=Be.a.parse(e)}catch(n){throw new He(n.message)}if(t.did!==e)throw new He("It seems that ".concat(e," is a DID URL and not a DID"));return t},Je=function(e){try{return Be.a.format(e)}catch(t){throw new Fe(t.message)}};function Xe(e,t){if(!t.has(e))throw new TypeError("attempted to get private field on non-instance");var n=t.get(e);return n.get?n.get.call(e):n.value}var qe=function(){function e(t){var n=this;Object(o.a)(this,e),ze.set(this,{writable:!0,value:void 0}),Qe.set(this,{writable:!0,value:function(e,t){if(!Xe(n,ze)[e])throw new F(e);if(!Xe(n,ze)[e][t])throw new G(e,t)}}),function(e,t,n){if(!t.has(e))throw new TypeError("attempted to set private field on non-instance");var r=t.get(e);if(r.set)r.set.call(e,n);else{if(!r.writable)throw new TypeError("attempted to set read only private field");r.value=n}}(this,ze,t)}return Object(p.a)(e,[{key:"getDid",value:function(){var e=Object(c.a)(a.a.mark(function e(t,n){return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return Xe(this,Qe).call(this,t,"getDid"),e.abrupt("return",Xe(this,ze)[t].getDid(n));case 2:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}()},{key:"resolve",value:function(){var e=Object(c.a)(a.a.mark(function e(t){var n,r;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=Ge(t),r=n.method,Xe(this,Qe).call(this,r,"resolve"),e.abrupt("return",Xe(this,ze)[r].resolve(t));case 3:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"create",value:function(){var e=Object(c.a)(a.a.mark(function e(t,n,r){return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return Xe(this,Qe).call(this,t,"create"),e.abrupt("return",Xe(this,ze)[t].create(n,r));case 2:case"end":return e.stop()}},e,this)}));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"update",value:function(){var e=Object(c.a)(a.a.mark(function e(t,n,r){var i,c;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return i=Ge(t),c=i.method,Xe(this,Qe).call(this,c,"update"),e.abrupt("return",Xe(this,ze)[c].update(t,n,r));case 3:case"end":return e.stop()}},e,this)}));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"isPublicKeyValid",value:function(){var e=Object(c.a)(a.a.mark(function e(t,n,r){var i,c;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return i=Ge(t),c=i.method,Xe(this,Qe).call(this,c,"isPublicKeyValid"),e.abrupt("return",Xe(this,ze)[c].isPublicKeyValid(t,n,r));case 3:case"end":return e.stop()}},e,this)}));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"getMethods",value:function(){return Object.values(Xe(this,ze)).map(function(e){return e.constructor.info})}},{key:"isSupported",value:function(e,t){try{return Xe(this,Qe).call(this,e,t),!0}catch(n){return!1}}}]),e}(),ze=new WeakMap,Qe=new WeakMap,Ze=function(e){var t={ipid:Ve(e)};return new qe(t)},$e=n(2549),et=n.n($e),tt=n(1235),nt=n.n(tt),rt=n(1659),at=n.n(rt);function it(e,t){if(!t.has(e))throw new TypeError("attempted to get private field on non-instance");var n=t.get(e);return n.get?n.get.call(e):n.value}function ct(e,t,n){if(!t.has(e))throw new TypeError("attempted to set private field on non-instance");var r=t.get(e);if(r.set)r.set.call(e,n);else{if(!r.writable)throw new TypeError("attempted to set read only private field");r.value=n}return n}var st=nt()(et.a),ut=function(){function e(t,n){var r=this;Object(o.a)(this,e),ot.set(this,{writable:!0,value:void 0}),pt.set(this,{writable:!0,value:void 0}),lt.set(this,{writable:!0,value:function(){var e=Object(c.a)(a.a.mark(function e(t){var n,s;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=Object(i.a)({keys:!0,values:!0},t),e.next=3,new Promise(function(e,n){var a=[];it(r,ot).createReadStream(t).on("data",function(e){return a.push(e)}).on("end",function(){return e(a)}).on("error",n)});case 3:return n=e.sent,e.next=6,at()(n,function(){var e=Object(c.a)(a.a.mark(function e(n){return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.values){e.next=12;break}if(!t.keys){e.next=8;break}return e.next=4,it(r,vt).call(r,n.value);case 4:n.value=e.sent,n.value=JSON.parse(n.value),e.next=12;break;case 8:return e.next=10,it(r,vt).call(r,n);case 10:n=e.sent,n=JSON.parse(n);case 12:return e.abrupt("return",n);case 13:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}());case 6:return s=e.sent,e.abrupt("return",s);case 8:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()}),ht.set(this,{writable:!0,value:function(){var e=Object(c.a)(a.a.mark(function e(t,n){var r,i;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=(new TextEncoder).encode(t),e.next=3,M(r,n,!0);case 3:return i=e.sent,e.abrupt("return",JSON.stringify(i));case 5:case"end":return e.stop()}},e)}));return function(t,n){return e.apply(this,arguments)}}()}),ft.set(this,{writable:!0,value:function(){var e=Object(c.a)(a.a.mark(function e(t,n){var r,i;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,T(t,n);case 2:return r=e.sent,i=(new TextDecoder).decode(r),e.abrupt("return",i);case 5:case"end":return e.stop()}},e)}));return function(t,n){return e.apply(this,arguments)}}()}),vt.set(this,{writable:!0,value:function(){var e=Object(c.a)(a.a.mark(function e(t){var n,i,c;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=JSON.parse(t),A(n)){e.next=3;break}return e.abrupt("return",t);case 3:return e.next=5,it(r,pt).getAsync();case 5:return i=e.sent,e.next=8,it(r,ft).call(r,n,i);case 8:return c=e.sent,e.abrupt("return",c);case 10:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()}),ct(this,ot,t),ct(this,pt,n)}return Object(p.a)(e,[{key:"has",value:function(){var e=Object(c.a)(a.a.mark(function e(t){var n;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,it(this,ot).get(t);case 3:n=e.sent,e.next=11;break;case 6:if(e.prev=6,e.t0=e.catch(0),"NotFoundError"!==e.t0.type){e.next=10;break}return e.abrupt("return",!1);case 10:throw e.t0;case 11:return e.abrupt("return",null!=n);case 12:case"end":return e.stop()}},e,this,[[0,6]])}));return function(t){return e.apply(this,arguments)}}()},{key:"get",value:function(){var e=Object(c.a)(a.a.mark(function e(t){var n;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,it(this,ot).get(t);case 3:return n=e.sent,e.next=6,it(this,vt).call(this,n);case 6:return n=e.sent,e.abrupt("return",JSON.parse(n));case 10:if(e.prev=10,e.t0=e.catch(0),"NotFoundError"!==e.t0.type){e.next=14;break}return e.abrupt("return",void 0);case 14:throw new we(e.t0.message,"get",e.t0.type);case 15:case"end":return e.stop()}},e,this,[[0,10]])}));return function(t){return e.apply(this,arguments)}}()},{key:"set",value:function(){var e=Object(c.a)(a.a.mark(function e(t,n,r){var c,s,u;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(c=Object(i.a)({},r),s=c.encrypt,e.prev=1,n=JSON.stringify(n),!s){e.next=10;break}return e.next=6,it(this,pt).getAsync();case 6:return u=e.sent,e.next=9,it(this,ht).call(this,n,u);case 9:n=e.sent;case 10:return e.next=12,it(this,ot).put(t,n);case 12:e.next=17;break;case 14:throw e.prev=14,e.t0=e.catch(1),new we(e.t0.message,"set",e.t0.type);case 17:case"end":return e.stop()}},e,this,[[1,14]])}));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"remove",value:function(){var e=Object(c.a)(a.a.mark(function e(t){return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,it(this,ot).del(t);case 3:e.next=8;break;case 5:throw e.prev=5,e.t0=e.catch(0),new we(e.t0.message,"remove",e.t0.type);case 8:case"end":return e.stop()}},e,this,[[0,5]])}));return function(t){return e.apply(this,arguments)}}()},{key:"clear",value:function(){var e=Object(c.a)(a.a.mark(function e(){var t,n;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,it(this,lt).call(this,{values:!1});case 3:return t=e.sent,n=t.map(function(e){return{type:"del",key:e}}),e.next=7,it(this,ot).batch(n);case 7:e.next=12;break;case 9:throw e.prev=9,e.t0=e.catch(0),new we(e.t0.message,"clear",e.t0.type);case 12:case"end":return e.stop()}},e,this,[[0,9]])}));return function(){return e.apply(this,arguments)}}()},{key:"list",value:function(){var e=Object(c.a)(a.a.mark(function e(t){var n;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,it(this,lt).call(this,t);case 3:return n=e.sent,e.abrupt("return",n);case 7:throw e.prev=7,e.t0=e.catch(0),new we(e.t0.message,"list",e.t0.type);case 10:case"end":return e.stop()}},e,this,[[0,7]])}));return function(t){return e.apply(this,arguments)}}()}]),e}(),ot=new WeakMap,pt=new WeakMap,lt=new WeakMap,ht=new WeakMap,ft=new WeakMap,vt=new WeakMap,dt=function(){var e=Object(c.a)(a.a.mark(function e(t){var n;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,st("idm-wallet-db",{});case 2:return n=e.sent,e.abrupt("return",new ut(n,t));case 4:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),wt=n(2560),bt=n.n(wt),yt=n(2561),kt=n.n(yt),Ot=n(2566),xt=n.n(Ot),gt=[{regExp:/Use a few words, avoid common phrases/i,code:"USE_A_FEW_WORDS"},{regExp:/No need for symbols, digits, or uppercase letters/i,code:"NO_NEED_FOR_MIXED_CHARS"},{regExp:/Add another word or two. Uncommon words are better/i,code:"UNCOMMON_WORDS_ARE_BETTER",message:"Add another word or two, uncommon words are better"},{regExp:/Straight rows of keys are easy to guess/i,code:"STRAIGHT_ROWS_OF_KEYS_ARE_EASY"},{regExp:/Short keyboard patterns are easy to guess/i,code:"SHORT_KEYBOARD_PATTERNS_ARE_EASY"},{regExp:/Use a longer keyboard pattern with more turns/i,code:"USE_LONGER_KEYBOARD_PATTERNS"},{regExp:/Repeats like "aaa" are easy to guess/i,code:"REPEATED_CHARS_ARE_EASY"},{regExp:/Repeats like "abcabcabc" are only slightly harder to guess than "abc"/i,code:"REPEATED_PATTERNS_ARE_EASY"},{regExp:/Repeats like "abcabcabc" are only slightly harder to guess than "abc"/i,code:"REPEATED_PATTERNS_ARE_EASY"},{regExp:/Avoid repeated words and characters/,code:"AVOID_REPEATED_CHARS"},{regExp:/Sequences like abc or 6543 are easy to guess/,code:"SEQUENCES_ARE_EASY"},{regExp:/Avoid sequences/,code:"AVOID_SEQUENCES"},{regExp:/Recent years are easy to guess/,code:"RECENT_YEARS_ARE_EASY"},{regExp:/Avoid recent years/,code:"AVOID_RECENT_YEARS"},{regExp:/Avoid years that are associated with you/,code:"AVOID_ASSOCIATED_YEARS"},{regExp:/Dates are often easy to guess/,code:"DATES_ARE_EASY"},{regExp:/Avoid dates and years that are associated with you/,code:"avoid_associated_dates_and_years"},{regExp:/This is a top-10 common password/,code:"TOP10_COMMON_PASSWORD"},{regExp:/This is a top-100 common password/,code:"TOP100_COMMON_PASSWORD"},{regExp:/This is a very common password/,code:"VERY_COMMON_PASSWORD"},{regExp:/This is similar to a commonly used password/,code:"SIMILAR_TO_COMMON_PASSWORD"},{regExp:/A word by itself is easy to guess/,code:"A_WORD_IS_EASY"},{regExp:/Names and surnames by themselves are easy to guess/,code:"NAMES_ARE_EASY"},{regExp:/Common names and surnames are easy to guess/,code:"COMMON_NAMES_ARE_EASY"},{regExp:/Capitalization doesn\\'t help very much/,code:"CAPITALIZATION_DOESNT_HELP"},{regExp:/All-uppercase is almost as easy to guess as all-lowercase/,code:"ALL_UPPERCASE_DOESNT_HELP"},{regExp:/Reversed words aren\\'t much harder to guess/,code:"REVERSE_DOESNT_HELP"},{regExp:/Predictable substitutions like \\'@\\' instead of \\'a\\' don\\'t help very much/,code:"SUBSTITUTION_DOESNT_HELP"}],mt=function(e){var t=gt.find(function(t){return t.regExp.test(e)});return t?{code:t.code,message:t.message||e}:{code:"UNKNOWN",message:e}},jt=function(e){var t=kt()(e),n=t.guesses_log10,r=t.feedback,a=xt()(n,[{value:0,norm:0},{value:4,norm:.25},{value:9,norm:.5},{value:13,norm:.75},{value:18,norm:.9},{value:25,norm:1}]),i=r.suggestions.map(mt),c=r.warning?mt(r.warning):null;return a<.5&&!c&&!i.length&&i.push({code:"UNCOMMON_WORDS_ARE_BETTER",message:"Add another word or two, uncommon words are better"}),{score:a,warning:c,suggestions:i}},Et=function(e){if(e)throw new Oe},Mt=function(e){if(!e)throw new he},Tt=function(e){if(e)throw new le};function At(e,t){if(!t.has(e))throw new TypeError("attempted to get private field on non-instance");var n=t.get(e);return n.get?n.get.call(e):n.value}function It(e,t,n){if(!t.has(e))throw new TypeError("attempted to set private field on non-instance");var r=t.get(e);if(r.set)r.set.call(e,n);else{if(!r.writable)throw new TypeError("attempted to set read only private field");r.value=n}return n}var Dt=nt()(bt.a,{errorFirst:!1}),Wt="locker.lock.passphrase",St=function(){function e(t,n,r,s){var u=this;Object(o.a)(this,e),_t.set(this,{writable:!0,value:void 0}),Pt.set(this,{writable:!0,value:void 0}),Rt.set(this,{writable:!0,value:void 0}),Nt.set(this,{writable:!0,value:void 0}),Ct.set(this,{writable:!0,value:Object(l.a)()}),Kt.set(this,{writable:!0,value:function(){var e=Object(c.a)(a.a.mark(function e(t){var n,r,i,c,s;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,At(u,Pt).getAsync();case 2:return n=e.sent,e.next=5,At(u,Lt).call(u,t);case 5:return r=e.sent,i=r.key,c=r.keyDerivation,e.next=10,M(n,i,!0);case 10:return s=e.sent,e.next=13,At(u,_t).set(Wt,{keyDerivation:c,encryptedSecret:s});case 13:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()}),Lt.set(this,{writable:!0,value:function(){var e=Object(c.a)(a.a.mark(function e(t){var n,r,c,s;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=v(16),r={N:32768,r:8,p:1},c=(new TextEncoder).encode(t),e.next=5,Dt(c,n,Object(i.a)({},r,{dkLen:32,encoding:"binary"}));case 5:return s=e.sent,e.abrupt("return",{key:s,keyDerivation:{algorithm:"scrypt",salt:w.a.toString(n,{uppercase:!1}),params:r}});case 7:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()}),Ut.set(this,{writable:!0,value:function(){var e=Object(c.a)(a.a.mark(function e(t,n){var r,c,s;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=w.a.fromString(n.salt),c=(new TextEncoder).encode(t),e.next=4,Dt(c,r,Object(i.a)({},n.params,{encoding:"binary"}));case 4:return s=e.sent,e.abrupt("return",s);case 6:case"end":return e.stop()}},e)}));return function(t,n){return e.apply(this,arguments)}}()}),Vt.set(this,{writable:!0,value:function(e){It(u,Nt,e),At(u,Ct).dispatch(e)}}),It(this,_t,t),It(this,Pt,n),It(this,Rt,r===this.getType()),It(this,Nt,!!s)}return Object(p.a)(e,[{key:"getType",value:function(){return"passphrase"}},{key:"isMaster",value:function(){return At(this,Rt)}},{key:"isEnabled",value:function(){return At(this,Nt)}},{key:"onEnabledChange",value:function(e){return At(this,Ct).add(e)}},{key:"enable",value:function(){var e=Object(c.a)(a.a.mark(function e(t){return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return Tt(At(this,Nt)),e.next=3,this.validate(t);case 3:return e.next=5,At(this,Kt).call(this,t);case 5:At(this,Vt).call(this,!0);case 6:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"disable",value:function(){var e=Object(c.a)(a.a.mark(function e(){return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return Mt(At(this,Nt)),Et(At(this,Rt)),e.next=4,At(this,_t).remove(Wt);case 4:At(this,Vt).call(this,!1);case 5:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"validate",value:function(){var e=Object(c.a)(a.a.mark(function e(t){var n;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!((n=jt(t)).score<.5)){e.next=3;break}throw new oe("Passphrase is too weak",n);case 3:return e.abrupt("return",n);case 4:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()},{key:"update",value:function(){var e=Object(c.a)(a.a.mark(function e(t,n){return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return Mt(At(this,Nt)),e.next=3,this.validate(t);case 3:if(!At(this,Rt)){e.next=6;break}return e.next=6,this.unlock(n);case 6:return e.next=8,At(this,Kt).call(this,t);case 8:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}()},{key:"unlock",value:function(){var e=Object(c.a)(a.a.mark(function e(t){var n,r,i,c,s;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return Mt(At(this,Nt)),e.next=3,At(this,_t).get(Wt);case 3:return n=e.sent,r=n.keyDerivation,i=n.encryptedSecret,e.next=8,At(this,Ut).call(this,t,r);case 8:return c=e.sent,e.prev=9,e.next=12,T(i,c);case 12:s=e.sent,e.next=18;break;case 15:throw e.prev=15,e.t0=e.catch(9),new pe("Passphrase is invalid");case 18:At(this,Pt).set(s);case 19:case"end":return e.stop()}},e,this,[[9,15]])}));return function(t){return e.apply(this,arguments)}}()}]),e}(),_t=new WeakMap,Pt=new WeakMap,Rt=new WeakMap,Nt=new WeakMap,Ct=new WeakMap,Kt=new WeakMap,Lt=new WeakMap,Ut=new WeakMap,Vt=new WeakMap,Yt=function(){var e=Object(c.a)(a.a.mark(function e(t,n,r){var i;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.has(Wt);case 2:return i=e.sent,e.abrupt("return",new St(t,n,r,i));case 4:case"end":return e.stop()}},e)}));return function(t,n,r){return e.apply(this,arguments)}}(),Bt=function(){var e=Object(c.a)(a.a.mark(function e(t,n,r){var i;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Promise.all([Yt(t,n,r)]);case 2:return i=e.sent,e.abrupt("return",i.reduce(function(e,t){return e[t.getType()]=t,e},{}));case 4:case"end":return e.stop()}},e)}));return function(t,n,r){return e.apply(this,arguments)}}();function Ht(e,t){if(!t.has(e))throw new TypeError("attempted to get private field on non-instance");var n=t.get(e);return n.get?n.get.call(e):n.value}function Ft(e,t,n){if(!t.has(e))throw new TypeError("attempted to set private field on non-instance");var r=t.get(e);if(r.set)r.set.call(e,n);else{if(!r.writable)throw new TypeError("attempted to set read only private field");r.value=n}return n}var Gt=function(){function e(t,n){var r=this;Object(o.a)(this,e),Jt.set(this,{writable:!0,value:void 0}),Xt.set(this,{writable:!0,value:void 0}),qt.set(this,{writable:!0,value:void 0}),zt.set(this,{writable:!0,value:void 0}),Qt.set(this,{writable:!0,value:0}),Zt.set(this,{writable:!0,value:Object(l.a)()}),$t.set(this,{writable:!0,value:function(){Ft(r,qt,void 0),Ft(r,zt,0),Ft(r,Qt,0),Ht(r,Zt).dispatch()}}),Ft(this,Jt,t),Ft(this,Xt,n)}return Object(p.a)(e,[{key:"restart",value:function(){clearTimeout(Ht(this,qt)),Ft(this,zt,Ht(this,Xt)),Ft(this,qt,setTimeout(Ht(this,$t),Ht(this,zt))),Ft(this,Qt,Date.now())}},{key:"getMaxTime",value:function(){return Ht(this,Xt)}},{key:"getRemainingTime",value:function(){var e=Ht(this,zt)-(Date.now()-Ht(this,Qt));return e>0?e:0}},{key:"setMaxTime",value:function(){var e=Object(c.a)(a.a.mark(function e(t){var n;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t<Ht(this,Xt),e.next=3,Ht(this,Jt).set("locker.idle.maxTime",t);case 3:Ft(this,Xt,t),Ht(this,qt)&&n&&this.restart();case 5:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"onTimeout",value:function(e){return Ht(this,Zt).add(e)}}]),e}(),Jt=new WeakMap,Xt=new WeakMap,qt=new WeakMap,zt=new WeakMap,Qt=new WeakMap,Zt=new WeakMap,$t=new WeakMap,en=function(){var e=Object(c.a)(a.a.mark(function e(t){var n,r;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.get("locker.idle.maxTime");case 2:return n=e.sent,r=n||18e4,e.abrupt("return",new Gt(t,r));case 5:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}();function tn(e,t){if(!t.has(e))throw new TypeError("attempted to get private field on non-instance");var n=t.get(e);return n.get?n.get.call(e):n.value}function nn(e,t,n){if(!t.has(e))throw new TypeError("attempted to set private field on non-instance");var r=t.get(e);if(r.set)r.set.call(e,n);else{if(!r.writable)throw new TypeError("attempted to set read only private field");r.value=n}return n}var rn=function(){function e(t,n,r,a,i){var c=this;Object(o.a)(this,e),an.set(this,{writable:!0,value:void 0}),cn.set(this,{writable:!0,value:void 0}),sn.set(this,{writable:!0,value:void 0}),un.set(this,{writable:!0,value:void 0}),on.set(this,{writable:!0,value:void 0}),pn.set(this,{writable:!0,value:void 0}),ln.set(this,{writable:!0,value:Object(l.a)()}),hn.set(this,{writable:!0,value:function(){tn(c,pn)||c.lock()}}),fn.set(this,{writable:!0,value:function(){var e=c.isLocked();e||tn(c,on).restart(),tn(c,ln).dispatch(e)}}),vn.set(this,{writable:!0,value:function(e){nn(c,pn,!e),e&&tn(c,on).restart()}}),nn(this,an,t),nn(this,cn,n),nn(this,sn,r),nn(this,un,a),nn(this,on,i),nn(this,pn,!tn(this,un).isEnabled()),tn(this,pn)?tn(this,cn).generate():tn(this,on).restart(),tn(this,on).onTimeout(tn(this,hn)),tn(this,un).onEnabledChange(tn(this,vn)),tn(this,cn).onDefinedChange(tn(this,fn))}return Object(p.a)(e,[{key:"isPristine",value:function(){return tn(this,pn)}},{key:"isLocked",value:function(){return!tn(this,cn).has()}},{key:"getSecret",value:function(){return tn(this,cn).get()}},{key:"listLockTypes",value:function(){return Object.keys(tn(this,sn))}},{key:"getLock",value:function(e){var t=tn(this,sn)[e];if(!t)throw new de(e);return t}},{key:"lock",value:function(){if(tn(this,pn))throw new ve;tn(this,cn).unset()}},{key:"onLockedChange",value:function(e){return tn(this,ln).add(e)}},{key:"idleTimer",get:function(){return tn(this,on)}},{key:"masterLock",get:function(){return tn(this,un)}}]),e}(),an=new WeakMap,cn=new WeakMap,sn=new WeakMap,un=new WeakMap,on=new WeakMap,pn=new WeakMap,ln=new WeakMap,hn=new WeakMap,fn=new WeakMap,vn=new WeakMap,dn=function(){var e=Object(c.a)(a.a.mark(function e(t,n){var r,i,c,s,u=arguments;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=u.length>2&&void 0!==u[2]?u[2]:"passphrase",e.next=3,en(t);case 3:return i=e.sent,e.next=6,Bt(t,n,r);case 6:if(c=e.sent,s=c[r]){e.next=10;break}throw new de(r);case 10:return e.abrupt("return",new rn(t,n,c,s,i));case 11:case"end":return e.stop()}},e)}));return function(t,n){return e.apply(this,arguments)}}(),wn=n(66),bn=n(1661),yn=n.n(bn),kn=n(1754),On="".concat("identity!","descriptor!"),xn=function(e){return On+e},gn=function(e){return"".concat("identity!","backup!").concat(e)},mn=function(e){return"".concat("identity!","currentDevice!").concat(e)},jn=n(2568),En=n.n(jn),Mn=n(2588),Tn=n.n(Mn),An=Symbol(),In=new Map,Dn=new Map,Wn=function(){function e(){Object(o.a)(this,e)}return Object(p.a)(e,[{key:"subscribe",value:function(){var e=Object(c.a)(a.a.mark(function e(){return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}},e)}));return function(){return e.apply(this,arguments)}}()},{key:"unsubscribe",value:function(){var e=Object(c.a)(a.a.mark(function e(){return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}},e)}));return function(){return e.apply(this,arguments)}}()},{key:"publish",value:function(){var e=Object(c.a)(a.a.mark(function e(){return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}},e)}));return function(){return e.apply(this,arguments)}}()},{key:"disconnect",value:function(){var e=Object(c.a)(a.a.mark(function e(){return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}},e)}));return function(){return e.apply(this,arguments)}}()}]),e}(),Sn=function(e,t){var n=e[An];if(!n)throw new Error("Can't retrieve identity id from OrbitDB");return"".concat(n,".").concat(t)},_n=function(){var e=Object(c.a)(a.a.mark(function e(t,n,r){var s;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!(s=In.get(t))){e.next=3;break}return e.abrupt("return",s);case 3:return(r=Object(i.a)({directory:"./orbitdb-".concat(t),replicate:!0},r)).replicate||(r.broker=Wn),e.next=7,Tn.a.createInstance(n,r);case 7:return s=e.sent,In.set(t,s),Dn.set(s,new Map),s.disconnect=En()(s.disconnect,function(){var e=Object(c.a)(a.a.mark(function e(n){return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.call(s,n);case 2:In.delete(t),Dn.delete(s);case 4:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()),Object.defineProperty(s,An,{value:t}),e.abrupt("return",s);case 13:case"end":return e.stop()}},e)}));return function(t,n,r){return e.apply(this,arguments)}}(),Pn=function(){var e=Object(c.a)(a.a.mark(function e(t){return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.keystore.destroy();case 2:return e.next=4,t.disconnect();case 4:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),Rn=function(){var e=Object(c.a)(a.a.mark(function e(t){var n;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if((n=Dn.get(t))&&n.size){e.next=4;break}return e.next=4,Pn(t);case 4:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),Nn=function(){var e=Object(c.a)(a.a.mark(function e(t){return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t._pubsub.subscribe=Object(c.a)(a.a.mark(function e(){return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}},e)})),t._pubsub.publish=Object(c.a)(a.a.mark(function e(){return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}},e)})),e.next=4,t._pubsub.disconnect();case 4:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),Cn=function(){var e=Object(c.a)(a.a.mark(function e(t,n,r,s){var u,o,p;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(u=Dn.get(t)){e.next=3;break}throw new Error("OrbitDB not created with getOrbitDb() or disconnect() was already called");case 3:if(!(o=u.get(n))){e.next=6;break}return e.abrupt("return",o);case 6:return p=Sn(t,n),e.next=9,t.open(p,Object(i.a)({type:r,create:!0,accessController:{write:["*"]}},s));case 9:return o=e.sent,u.set(n,o),o.close=En()(o.close,function(){var e=Object(c.a)(a.a.mark(function e(t){return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.call(o);case 2:u.delete(n);case 3:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()),e.abrupt("return",o);case 13:case"end":return e.stop()}},e)}));return function(t,n,r,a){return e.apply(this,arguments)}}(),Kn=function(){var e=Object(c.a)(a.a.mark(function e(t,n,r,i){var c;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Cn(t,n,r,i);case 2:return c=e.sent,e.next=5,c.load();case 5:return e.abrupt("return",c);case 6:case"end":return e.stop()}},e)}));return function(t,n,r,a){return e.apply(this,arguments)}}(),Ln=function(){var e=Object(c.a)(a.a.mark(function e(t,n,r,c){var s;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Cn(t,n,r,Object(i.a)({replicate:!1},c));case 2:return s=e.sent,e.next=5,s.drop();case 5:case"end":return e.stop()}},e)}));return function(t,n,r,a){return e.apply(this,arguments)}}(),Un=function(e,t){var n;return t=Object(i.a)({timeout:3e4,completeCondition:function(){return!0}},t),new Promise(function(r){var a=function(){clearTimeout(n),n=setTimeout(function(){return r(!1)},t.timeout)};if(a(),t.completeCondition())return r(!0);e.events.on("replicate",function(){return a()}),e.events.on("replicate.progress",function(){return a()}),e.events.on("replicated",function(){a();var n=e.replicationStatus,i=n.queued,c=n.buffered;i<=0&&c<=0&&t.completeCondition()&&r(!0)})})},Vn=n(309),Yn=n(1693),Bn=n.n(Yn),Hn=n(2672),Fn=n.n(Hn),Gn=n(1700),Jn=n.n(Gn),Xn=n(2680),qn=n.n(Xn),zn=function(e){var t=e.id,n=e.name,r=e.homepageUrl,a=e.iconUrl;if(!t||"string"!==typeof t)throw new ae("id",t);if(!n||"string"!==typeof n)throw new ae("name",n);if(r&&"string"!==typeof r)throw new ae("homepageUrl",r);if(a&&"string"!==typeof a)throw new ae("iconUrl",a)},Qn=n(17),Zn=["phone","tablet","laptop","desktop"],$n=["keyMaterial.privateKeyPem","keyMaterial.privateKeyBase58","keyMaterial.privateExtendedKeyBase58"],er=function(e){var t=e||{},n=t.type,r=t.name,a=Object(Qn.a)(t,["type","name"]);if(!Zn.includes(n))throw new $("type",n);if(!r||"string"!==typeof r)throw new $("name",r);var i=Object.keys(a);if(i.length)throw new ne(i[0])},tr=n(39),nr=n(1084),rr=n.n(nr),ar=["Person","Organization","Thing"],ir=["@context","@type","name"],cr=["image"],sr=function(e,t){switch(e){case"@context":if("https://schema.org"!==t)throw new X(e,t);break;case"@type":if(!ar.includes(t))throw new X(e,t);break;case"name":if("string"!==typeof t||!t.trim())throw new X(e,t);break;case"image":if(!rr()(t))throw new X(e,t);var n=t.type,r=t.data,a=Object(Qn.a)(t,["type","data"]);if("string"!==typeof n)throw new X("".concat(e,".type"),n);var i=n.split("/");if(2!==i.length||"image"!==i[0])throw new X("".concat(e,".type"),n);if(!(r instanceof ArrayBuffer))throw new X("".concat(e,".data"),r);var c=Object.keys(a);if(c.length)throw new z("".concat(e,".").concat(c[0]));break;case"gender":if(!["Male","Female","Other"].includes(t))throw new X(e,t);break;case"nationality":case"address":if("string"!==typeof t||!t.trim())throw new X(e,t);break;default:throw new z(e)}},ur=function(e){ir.forEach(function(t){var n=e&&e[t];if(void 0===n)throw new X(t,n)}),Object.entries(e).forEach(function(e){var t=Object(tr.a)(e,2),n=t[0],r=t[1];return sr(n,r)})},or=function(e){if(ir.includes(e))throw new q(e)};function pr(e,t){if(!t.has(e))throw new TypeError("attempted to get private field on non-instance");var n=t.get(e);return n.get?n.get.call(e):n.value}function lr(e,t,n){if(!t.has(e))throw new TypeError("attempted to set private field on non-instance");var r=t.get(e);if(r.set)r.set.call(e,n);else{if(!r.writable)throw new TypeError("attempted to set read only private field");r.value=n}return n}var hr=function(){function e(t,n,r,a){var c=this;Object(o.a)(this,e),fr.set(this,{writable:!0,value:void 0}),vr.set(this,{writable:!0,value:void 0}),dr.set(this,{writable:!0,value:void 0}),wr.set(this,{writable:!0,value:void 0}),br.set(this,{writable:!0,value:void 0}),yr.set(this,{writable:!0,value:void 0}),kr.set(this,{writable:!0,value:Object(l.a)()}),Or.set(this,{writable:!0,value:Object(l.a)()}),xr.set(this,{writable:!0,value:function(){var e=pr(c,fr).id;lr(c,br,Object(i.a)({},pr(c,wr).all)),pr(c,br)[e]&&(pr(c,br)[e]=Fn()(Object(i.a)({},pr(c,br)[e]),Jn()(pr(c,fr),$n))),lr(c,yr,Object.values(pr(c,br))),pr(c,yr).sort(function(e,t){return t.createdAt-e.createdAt}),pr(c,kr).dispatch(pr(c,yr))}}),gr.set(this,{writable:!0,value:function(){var e=pr(c,mr).call(c);pr(c,xr).call(c),!e&&pr(c,mr).call(c)&&pr(c,Or).dispatch()}}),mr.set(this,{writable:!0,value:function(){var e=pr(c,fr).id;return!pr(c,br)[e]||!!pr(c,br)[e].revokedAt}}),lr(this,fr,t),lr(this,vr,n),lr(this,dr,r),lr(this,wr,a),pr(this,wr).events.on("write",pr(this,gr)),pr(this,wr).events.on("replicated",pr(this,gr)),pr(this,xr).call(this)}return Object(p.a)(e,[{key:"list",value:function(){return pr(this,yr)}},{key:"getCurrent",value:function(){return this.get(pr(this,fr).id)}},{key:"has",value:function(e){return Boolean(pr(this,br)[e])}},{key:"get",value:function(e){var t=pr(this,br)[e];if(!t)throw new ee(e);return t}},{key:"revoke",value:function(){var e=Object(c.a)(a.a.mark(function e(t,n){var r;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r=pr(this,br)[t]){e.next=3;break}throw new ee(t);case 3:if(t!==pr(this,fr).id){e.next=5;break}throw new te("Revoking own device is not allowed");case 5:if(r.revokedAt){e.next=10;break}return e.next=8,pr(this,dr).update(pr(this,vr).did,n,function(e){e.revokePublicKey(r.didPublicKeyId)});case 8:return e.next=10,pr(this,wr).put(t,Object(i.a)({},r,{revokedAt:Date.now()}));case 10:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}()},{key:"updateInfo",value:function(){var e=Object(c.a)(a.a.mark(function e(t,n){var r,c;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(er(n),r=pr(this,br)[t]){e.next=4;break}throw new ee(t);case 4:if(c=Jn()(r,Object.keys(n)),Bn()(n,c)){e.next=8;break}return e.next=8,pr(this,wr).put(t,Object(i.a)({},r,{updatedAt:Date.now()},n));case 8:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}()},{key:"onChange",value:function(e){return pr(this,kr).add(e)}},{key:"onCurrentRevoke",value:function(e){return pr(this,Or).add(e)}}]),e}(),fr=new WeakMap,vr=new WeakMap,dr=new WeakMap,wr=new WeakMap,br=new WeakMap,yr=new WeakMap,kr=new WeakMap,Or=new WeakMap,xr=new WeakMap,gr=new WeakMap,mr=new WeakMap,jr=function(){var e=Object(c.a)(a.a.mark(function e(t){var n,r,c,s;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,B();case 2:return n=e.sent,e.next=5,D(n.publicKeyPem,!0);case 5:return r=e.sent,c=Object(i.a)({id:r,createdAt:Date.now(),updatedAt:Date.now(),revokedAt:null,didPublicKeyId:"".concat("idm-device-").concat(r),keyMaterial:n},t),s={id:c.didPublicKeyId,type:"EdDsaSAPublicKeySecp256k1",publicKeyPem:n.publicKeyPem,publicExtendedKeyBase58:n.publicExtendedKeyBase58},e.abrupt("return",{currentDevice:c,didPublicKey:s});case 9:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),Er=function(){var e=Object(c.a)(a.a.mark(function e(t,n,r,i,c){var s,u,o;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return s=qn()(t,$n),u=Jn()(t,["id"].concat(Object(Vn.a)($n))),e.next=4,Kn(c,"devices","keyvalue");case 4:return o=e.sent,e.next=7,i.set(mn(n.id),u,{encrypt:!0});case 7:return e.next=9,o.put(u.id,s);case 9:return e.abrupt("return",new hr(t,n,r,o));case 10:case"end":return e.stop()}},e)}));return function(t,n,r,a,i){return e.apply(this,arguments)}}(),Mr=function(){var e=Object(c.a)(a.a.mark(function e(t,n,r,i){var c,s;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,r.get(mn(t.id));case 2:return c=e.sent,e.next=5,Kn(i,"devices","keyvalue");case 5:return s=e.sent,e.abrupt("return",new hr(c,t,n,s));case 7:case"end":return e.stop()}},e)}));return function(t,n,r,a){return e.apply(this,arguments)}}(),Tr=function(){var e=Object(c.a)(a.a.mark(function e(t,n,r){return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.remove(mn(t.id));case 2:return e.next=4,Ln(r,"devices","keyvalue");case 4:case"end":return e.stop()}},e)}));return function(t,n,r){return e.apply(this,arguments)}}();function Ar(e,t){if(!t.has(e))throw new TypeError("attempted to get private field on non-instance");var n=t.get(e);return n.get?n.get.call(e):n.value}function Ir(e,t,n){if(!t.has(e))throw new TypeError("attempted to set private field on non-instance");var r=t.get(e);if(r.set)r.set.call(e,n);else{if(!r.writable)throw new TypeError("attempted to set read only private field");r.value=n}return n}var Dr=function(){function e(t,n,r){Object(o.a)(this,e),Wr.set(this,{writable:!0,value:void 0}),Sr.set(this,{writable:!0,value:void 0}),_r.set(this,{writable:!0,value:void 0}),Ir(this,Wr,t),Ir(this,Sr,n),Ir(this,_r,r)}return Object(p.a)(e,[{key:"isComplete",value:function(){return!Ar(this,Wr)}},{key:"getData",value:function(){return Ar(this,Wr)}},{key:"setComplete",value:function(){var e=Object(c.a)(a.a.mark(function e(){return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.isComplete()){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,Ar(this,_r).remove(gn(Ar(this,Sr).id));case 4:Ir(this,Wr,void 0);case 5:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()}]),e}(),Wr=new WeakMap,Sr=new WeakMap,_r=new WeakMap,Pr=function(){var e=Object(c.a)(a.a.mark(function e(t,n,r){var c;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!t){e.next=4;break}return c=Object(i.a)({},t,{seed:w.a.toString(t.seed,{uppercase:!1})}),e.next=4,r.set(gn(n.id),c,{encrypt:!0});case 4:return e.abrupt("return",new Dr(t,n,r));case 5:case"end":return e.stop()}},e)}));return function(t,n,r){return e.apply(this,arguments)}}(),Rr=function(){var e=Object(c.a)(a.a.mark(function e(t,n){var r,c;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.get(gn(t.id));case 2:return r=e.sent,c=r&&Object(i.a)({},r,{seed:w.a.fromString(r.seed)}),e.abrupt("return",new Dr(c,t,n));case 5:case"end":return e.stop()}},e)}));return function(t,n){return e.apply(this,arguments)}}(),Nr=function(){var e=Object(c.a)(a.a.mark(function e(t,n){return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:n.remove(gn(t.id));case 1:case"end":return e.stop()}},e)}));return function(t,n){return e.apply(this,arguments)}}(),Cr=n(2700),Kr=n.n(Cr),Lr=n(2702),Ur=n.n(Lr),Vr=n(2703),Yr=n.n(Vr),Br=n(1703),Hr=n.n(Br),Fr=n(2710),Gr=n.n(Fr),Jr=n(2712),Xr=n.n(Jr),qr=1e4,zr=6e4,Qr=new URL("https://ipfs.infura.io:5001/api/v0"),Zr=Xr()({host:Qr.hostname,port:Qr.port,protocol:Qr.protocol.slice(0,-1),"api-url":Qr.pathname});function $r(e,t){if(!t.has(e))throw new TypeError("attempted to get private field on non-instance");var n=t.get(e);return n.get?n.get.call(e):n.value}var ea=function(){function e(t){var n=this;Object(o.a)(this,e),ta.set(this,{writable:!0,value:void 0}),na.set(this,{writable:!0,value:new Map}),ra.set(this,{writable:!0,value:Object(l.a)()}),aa.set(this,{writable:!0,value:function(){var e=Object(c.a)(a.a.mark(function e(t){return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:$r(n,na).delete(t),$r(n,sa).call(n,t);case 2:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()}),ia.set(this,{writable:!0,value:function(){var e=Object(c.a)(a.a.mark(function e(t,r){return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,$r(n,ca).call(n,t,r);case 2:case"end":return e.stop()}},e)}));return function(t,n){return e.apply(this,arguments)}}()}),ca.set(this,{writable:!0,value:function(){var e=Object(c.a)(a.a.mark(function e(t,r){var c;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=Object(i.a)({},r,{status:"syncing",error:void 0}),$r(n,na).set(t,r),$r(n,sa).call(n,t),e.prev=3,e.next=6,$r(n,ta).pin.add(r.hash);case 6:$r(n,oa).call(n,t,r.hash).catch(function(e){return console.warn('Unable to check and add "'.concat(t,'" to infura'),e)}),c=Object(i.a)({},r,{status:"synced",error:void 0}),e.next=13;break;case 10:e.prev=10,e.t0=e.catch(3),c=Object(i.a)({},r,{status:"error",error:e.t0});case 13:$r(n,na).get(t)===r&&($r(n,na).set(t,c),$r(n,sa).call(n,t,!0));case 15:case"end":return e.stop()}},e,null,[[3,10]])}));return function(t,n){return e.apply(this,arguments)}}()}),sa.set(this,{writable:!0,value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=$r(n,na).get(e);$r(n,ra).dispatch(e,r,t)}}),ua.set(this,{writable:!0,value:function(){var e=Object(c.a)(a.a.mark(function e(t){var r,i,c,s;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=_.Buffer.from(t.data),e.next=3,$r(n,ta).add(r,{cidVersion:0,pin:!0});case 3:return i=e.sent,c=Object(tr.a)(i,1),s=c[0].hash,e.abrupt("return",s);case 7:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()}),oa.set(this,{writable:!0,value:function(){var e=Object(c.a)(a.a.mark(function e(t,r,i){var c,s,u;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Gr()(Zr.block.stat(r).then(function(){return!0}),qr,function(){return!1});case 2:if(!e.sent){e.next=5;break}return e.abrupt("return");case 5:if(i){e.next=12;break}return e.next=8,$r(n,ta).get(r);case 8:c=e.sent,s=Object(tr.a)(c,1),u=s[0].content,i=u.buffer.slice(u.byteOffset,u.byteOffset+u.byteLength);case 12:return e.next=14,$r(n,pa).call(n,t,r,i);case 14:case"end":return e.stop()}},e)}));return function(t,n,r){return e.apply(this,arguments)}}()}),pa.set(this,{writable:!0,value:function(){var e=Object(c.a)(a.a.mark(function e(t,n,r){var i,c,s,u;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return i=_.Buffer.from(r),e.next=3,Gr()(Zr.add(i,{cidVersion:0,pin:!0}),zr);case 3:if(c=e.sent,s=Object(tr.a)(c,1),(u=s[0].hash)===n){e.next=8;break}throw new Z(u,n);case 8:return e.abrupt("return",n);case 9:case"end":return e.stop()}},e)}));return function(t,n,r){return e.apply(this,arguments)}}()}),function(e,t,n){if(!t.has(e))throw new TypeError("attempted to set private field on non-instance");var r=t.get(e);if(r.set)r.set.call(e,n);else{if(!r.writable)throw new TypeError("attempted to set read only private field");r.value=n}}(this,ta,t)}return Object(p.a)(e,[{key:"get",value:function(e){return $r(this,na).get(e)}},{key:"getUrl",value:function(e){var t=$r(this,na).get(e);return t&&"synced"===t.status?"".concat("https://ipfs.infura.io:5001/api/v0","/cat?arg=").concat(t.hash):void 0}},{key:"put",value:function(){var e=Object(c.a)(a.a.mark(function e(t,n){var r,i,c;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=n.type,e.next=3,$r(this,ua).call(this,n);case 3:return i=e.sent,e.next=6,$r(this,pa).call(this,t,i,n.data).catch(function(e){return console.warn('Unable to add "'.concat(t,'" to infura'),e)});case 6:if(!(c=$r(this,na).get(t))||c.type!==r||c.hash!==i||"synced"!==c.status){e.next=9;break}return e.abrupt("return",c);case 9:return c={type:r,hash:i,status:"synced",error:void 0},$r(this,na).set(t,c),$r(this,sa).call(this,t),e.abrupt("return",c);case 13:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}()},{key:"del",value:function(){var e=Object(c.a)(a.a.mark(function e(t){return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:$r(this,na).get(t)&&($r(this,na).delete(t),$r(this,sa).call(this,t));case 2:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"sync",value:function(){var e=Object(c.a)(a.a.mark(function e(t){var n,r,i,c,s,u=this;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=Object.keys(t),r=Array.from($r(this,na).keys()),i=Hr()(r,n),c=Hr()(n,r),s=n.filter(function(e){var n=t[e],r=$r(u,na).get(e);return r&&(n.type!==r.type||n.hash!==r.hash)}),e.next=7,Promise.all([].concat(Object(Vn.a)(i.map(function(e){return $r(u,aa).call(u,e)})),Object(Vn.a)(c.map(function(e){return $r(u,ca).call(u,e,t[e])})),Object(Vn.a)(s.map(function(e){return $r(u,ia).call(u,e,t[e])}))));case 7:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"onChange",value:function(e){return $r(this,ra).add(e)}}]),e}(),ta=new WeakMap,na=new WeakMap,ra=new WeakMap,aa=new WeakMap,ia=new WeakMap,ca=new WeakMap,sa=new WeakMap,ua=new WeakMap,oa=new WeakMap,pa=new WeakMap,la=function(e){return new ea(e)};function ha(e,t){if(!t.has(e))throw new TypeError("attempted to get private field on non-instance");var n=t.get(e);return n.get?n.get.call(e):n.value}function fa(e,t,n){if(!t.has(e))throw new TypeError("attempted to set private field on non-instance");var r=t.get(e);if(r.set)r.set.call(e,n);else{if(!r.writable)throw new TypeError("attempted to set read only private field");r.value=n}return n}var va=new Map,da=function(){function e(t,n){var r=this;Object(o.a)(this,e),wa.set(this,{writable:!0,value:void 0}),ba.set(this,{writable:!0,value:void 0}),ya.set(this,{writable:!0,value:void 0}),ka.set(this,{writable:!0,value:Object(l.a)()}),Oa.set(this,{writable:!0,value:function(){var e=Object(c.a)(a.a.mark(function e(t,n){var i;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!cr.includes(t)){e.next=5;break}return e.next=3,ha(r,ba).put(t,n);case 3:i=e.sent,n=Jn()(i,"type","hash");case 5:if(Bn()(ha(r,wa).get(t),n)){e.next=8;break}return e.next=8,ha(r,wa).put(t,n);case 8:case"end":return e.stop()}},e)}));return function(t,n){return e.apply(this,arguments)}}()}),xa.set(this,{writable:!0,value:function(){var e=Object(c.a)(a.a.mark(function e(t){return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!Kr()(ha(r,wa).all,t)){e.next=3;break}return e.next=3,ha(r,wa).del(t);case 3:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()}),ga.set(this,{writable:!0,value:function(){var e=Jn()(ha(r,wa).all,cr);ha(r,ba).sync(e)}}),ma.set(this,{writable:!0,value:function(){var e=Object(i.a)({},ha(r,wa).all);cr.forEach(function(t){e[t]&&(e[t]=ha(r,ba).getUrl(t))}),Bn()(ha(r,ya),e)||fa(r,ya,e)}}),ja.set(this,{writable:!0,value:function(){ha(r,ga).call(r),ha(r,ma).call(r),ha(r,ka).dispatch()}}),Ea.set(this,{writable:!0,value:function(e,t,n){n&&(ha(r,ma).call(r),ha(r,ka).dispatch())}}),fa(this,wa,t),ha(this,wa).events.on("write",ha(this,ja)),ha(this,wa).events.on("replicated",ha(this,ja)),fa(this,ba,n),ha(this,ba).onChange(ha(this,Ea)),ha(this,ga).call(this),ha(this,ma).call(this)}return Object(p.a)(e,[{key:"getProperty",value:function(e){return ha(this,ba).get(e)||ha(this,wa).get(e)}},{key:"setProperty",value:function(){var e=Object(c.a)(a.a.mark(function e(t,n){return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return sr(t,n),e.next=3,ha(this,Oa).call(this,t,n);case 3:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}()},{key:"unsetProperty",value:function(){var e=Object(c.a)(a.a.mark(function e(t){return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return or(t),e.next=3,ha(this,xa).call(this,t);case 3:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"setProperties",value:function(){var e=Object(c.a)(a.a.mark(function e(t){var n,r=this;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=Object.entries(t).map(function(e){var t=Object(tr.a)(e,2),n=t[0],a=t[1];return void 0===a?(or(n),function(){return ha(r,xa).call(r,n)}):(sr(n,a),function(){return ha(r,Oa).call(r,n,a)})}),e.abrupt("return",Yr()(n));case 2:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()},{key:"getDetails",value:function(){return ha(this,ya)}},{key:"onChange",value:function(e){return ha(this,ka).add(e)}}]),e}(),wa=new WeakMap,ba=new WeakMap,ya=new WeakMap,ka=new WeakMap,Oa=new WeakMap,xa=new WeakMap,ga=new WeakMap,ma=new WeakMap,ja=new WeakMap,Ea=new WeakMap,Ma=function(){var e=Object(c.a)(a.a.mark(function e(t,n){var r;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Un(t,{timeout:6e4,completeCondition:function(){return ir.every(function(e){return null!=t.get(e)})}});case 2:if(e.sent){e.next=5;break}throw new Q;case 5:if(!(r=t.get("image"))){e.next=9;break}return e.next=9,Promise.race([Ur.a.reject(6e4,{value:new Q}),n.sync({image:r}).catch(function(e){console.warn("Unable to replicate image blob, skipping..",e)})]);case 9:case"end":return e.stop()}},e)}));return function(t,n){return e.apply(this,arguments)}}(),Ta=function(e,t,n){var r=setTimeout(Object(c.a)(a.a.mark(function r(){return a.a.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.prev=0,r.next=3,n.drop();case 3:return r.next=5,Rn(t);case 5:r.next=10;break;case 7:r.prev=7,r.t0=r.catch(0),console.warn("Unable to drop profile OrbitDB store for identity after peeking: ".concat(e.id),r.t0);case 10:case"end":return r.stop()}},r,null,[[0,7]])})),18e4);va.set(n,r)},Aa=function(e){var t=va.get(e);clearTimeout(t),va.delete(e)},Ia=function(){var e=Object(c.a)(a.a.mark(function e(t,n,r){var i,c,s;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Kn(r,"profile","keyvalue");case 2:return i=e.sent,c=la(n),Aa(i),e.next=7,Ma(i,c);case 7:return Ta(t.id,r,i),s=new da(i,c),e.abrupt("return",s.getDetails());case 10:case"end":return e.stop()}},e)}));return function(t,n,r){return e.apply(this,arguments)}}(),Da=function(){var e=Object(c.a)(a.a.mark(function e(t,n,r,i){var c,s,u,o,p,l,h,f,v;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Kn(i,"profile","keyvalue");case 2:if(c=e.sent,s=la(r),u=new da(c,s),Aa(c),!t){e.next=22;break}return e.next=9,c.put("identifier",n.did);case 9:o=0,p=Object.entries(t);case 10:if(!(o<p.length)){e.next=20;break}return l=p[o],h=Object(tr.a)(l,2),f=h[0],v=h[1],e.next=17,u.setProperty(f,v);case 17:o++,e.next=10;break;case 20:e.next=24;break;case 22:return e.next=24,Ma(c,s);case 24:return e.abrupt("return",u);case 25:case"end":return e.stop()}},e)}));return function(t,n,r,a){return e.apply(this,arguments)}}(),Wa=function(){var e=Object(c.a)(a.a.mark(function e(t,n,r){var i,c;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Kn(r,"profile","keyvalue");case 2:return i=e.sent,c=la(n),Aa(i),e.abrupt("return",new da(i,c));case 6:case"end":return e.stop()}},e)}));return function(t,n,r){return e.apply(this,arguments)}}(),Sa=function(){var e=Object(c.a)(a.a.mark(function e(t,n,r){return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Ln(r,"profile","keyvalue");case 2:case"end":return e.stop()}},e)}));return function(t,n,r){return e.apply(this,arguments)}}();function _a(e,t){if(!t.has(e))throw new TypeError("attempted to get private field on non-instance");var n=t.get(e);return n.get?n.get.call(e):n.value}function Pa(e,t,n){if(!t.has(e))throw new TypeError("attempted to set private field on non-instance");var r=t.get(e);if(r.set)r.set.call(e,n);else{if(!r.writable)throw new TypeError("attempted to set read only private field");r.value=n}return n}var Ra=function(){function e(t,n,r,a){var c=this;Object(o.a)(this,e),Na.set(this,{writable:!0,value:void 0}),Ca.set(this,{writable:!0,value:void 0}),Ka.set(this,{writable:!0,value:void 0}),La.set(this,{writable:!0,value:void 0}),Ua.set(this,{writable:!0,value:void 0}),Va.set(this,{writable:!0,value:void 0}),Ya.set(this,{writable:!0,value:Object(l.a)()}),Ba.set(this,{writable:!0,value:Object(l.a)()}),Ha.set(this,{writable:!0,value:function(e){return"".concat(e,"!").concat(_a(c,Na))}}),Fa.set(this,{writable:!0,value:function(e){var t=e.split("!"),n=Object(tr.a)(t,2);return{appId:n[0],deviceId:n[1]}}}),Ga.set(this,{writable:!0,value:function(){var e=Object(i.a)({},_a(c,Ka).all),t=Object(i.a)({},_a(c,La).all),n=Object.keys(t).reduce(function(t,n){var r=_a(c,Fa).call(c,n),a=r.appId,i=r.deviceId,s=e[a];return s&&i===_a(c,Na)&&(t[a]=s),t},{});Pa(c,Ua,n),Pa(c,Va,Object.values(_a(c,Ua))),_a(c,Ya).dispatch(_a(c,Va),_a(c,Ca).id)}}),Ja.set(this,{writable:!0,value:function(e,t){_a(c,Ba).dispatch({appId:e,deviceId:c.currentDeviceId,isLinked:t})}}),Xa.set(this,{writable:!0,value:function(){_a(c,Ga).call(c)}}),qa.set(this,{writable:!0,value:function(e,t){var n=t.payload,r=n.op,a=n.key,i=_a(c,Fa).call(c,a),s=i.appId,u=i.deviceId;_a(c,Ga).call(c),u===_a(c,Na)&&("PUT"===r?_a(c,Ja).call(c,s,!0):"DEL"===r&&_a(c,Ja).call(c,s,!1))}}),za.set(this,{writable:!0,value:function(){var e=Object.keys(_a(c,Ua));_a(c,Ga).call(c);var t=Object.keys(_a(c,Ua)),n=Hr()(t,e),r=Hr()(e,t);n.forEach(function(e){return _a(c,Ja).call(c,e,!0)}),r.forEach(function(e){return _a(c,Ja).call(c,e,!1)})}}),Pa(this,Na,t),Pa(this,Ca,n),Pa(this,Ka,r),Pa(this,La,a),_a(this,Ka).events.on("write",_a(this,Xa)),_a(this,Ka).events.on("replicated",_a(this,za)),_a(this,La).events.on("write",_a(this,qa)),_a(this,La).events.on("replicated",_a(this,za)),_a(this,Ga).call(this)}return Object(p.a)(e,[{key:"list",value:function(){return _a(this,Va)}},{key:"has",value:function(e){return Boolean(_a(this,Ua)[e])}},{key:"get",value:function(e){if(!_a(this,Ua)[e])throw new re(e);return _a(this,Ua)[e]}},{key:"add",value:function(){var e=Object(c.a)(a.a.mark(function e(t){return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return zn(t),e.next=3,_a(this,Ka).put(t.id,t);case 3:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"revoke",value:function(){var e=Object(c.a)(a.a.mark(function e(t){var n,r,i=this;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=Object.keys(_a(this,La).all),r=n.filter(function(e){return _a(i,Fa).call(i,e).appId===t}),e.next=4,Promise.all(r.map(function(e){return _a(i,La).del(e)}));case 4:return e.next=6,_a(this,Ka).del(t);case 6:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"linkCurrentDevice",value:function(){var e=Object(c.a)(a.a.mark(function e(t){var n;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(_a(this,Ka).get(t)){e.next=2;break}throw new re(t);case 2:if(n=_a(this,Ha).call(this,t),!_a(this,La).get(n)){e.next=5;break}return e.abrupt("return");case 5:return e.next=7,_a(this,La).put(n,!0);case 7:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"unlinkCurrentDevice",value:function(){var e=Object(c.a)(a.a.mark(function e(t){var n;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=_a(this,Ha).call(this,t),_a(this,La).all[n]){e.next=3;break}return e.abrupt("return");case 3:return e.next=5,_a(this,La).del(n);case 5:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"onChange",value:function(e){return _a(this,Ya).add(e)}},{key:"onLinkCurrentChange",value:function(e){return _a(this,Ba).add(e)}}]),e}(),Na=new WeakMap,Ca=new WeakMap,Ka=new WeakMap,La=new WeakMap,Ua=new WeakMap,Va=new WeakMap,Ya=new WeakMap,Ba=new WeakMap,Ha=new WeakMap,Fa=new WeakMap,Ga=new WeakMap,Ja=new WeakMap,Xa=new WeakMap,qa=new WeakMap,za=new WeakMap,Qa=function(){var e=Object(c.a)(a.a.mark(function e(t){var n,r;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Kn(t,"apps","keyvalue");case 2:return n=e.sent,e.next=5,Kn(t,"apps!devices","keyvalue");case 5:return r=e.sent,e.next=8,n.load();case 8:return e.next=10,r.load();case 10:return e.abrupt("return",{appsStore:n,appsDevicesStore:r});case 11:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),Za=function(){var e=Object(c.a)(a.a.mark(function e(t,n,r){var i,c,s;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Qa(r,n.id);case 2:return i=e.sent,c=i.appsStore,s=i.appsDevicesStore,e.abrupt("return",new Ra(t,n,c,s));case 6:case"end":return e.stop()}},e)}));return function(t,n,r){return e.apply(this,arguments)}}(),$a=function(){var e=Object(c.a)(a.a.mark(function e(t,n){return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Ln(n,"apps","keyvalue");case 2:return e.next=4,Ln(n,"apps!devices","keyvalue");case 4:case"end":return e.stop()}},e)}));return function(t,n){return e.apply(this,arguments)}}();function ei(e,t){if(!t.has(e))throw new TypeError("attempted to get private field on non-instance");var n=t.get(e);return n.get?n.get.call(e):n.value}function ti(e,t,n){if(!t.has(e))throw new TypeError("attempted to set private field on non-instance");var r=t.get(e);if(r.set)r.set.call(e,n);else{if(!r.writable)throw new TypeError("attempted to set read only private field");r.value=n}return n}var ni=function(){function e(t,n,r,i,s,u,p){var h=this;Object(o.a)(this,e),ri.set(this,{writable:!0,value:void 0}),ai.set(this,{writable:!0,value:void 0}),ii.set(this,{writable:!0,value:void 0}),ci.set(this,{writable:!0,value:void 0}),si.set(this,{writable:!0,value:void 0}),ui.set(this,{writable:!0,value:void 0}),oi.set(this,{writable:!0,value:void 0}),pi.set(this,{writable:!0,value:void 0}),li.set(this,{writable:!0,value:Object(l.a)()}),hi.set(this,{writable:!0,value:function(){var e=ei(h,ci).getCurrent(),t=e.didPublicKeyId,n=e.keyMaterial,r=Je({did:h.getDid(),fragment:t});return Object(kn.a)(r,n.privateKeyPem)}}),fi.set(this,{writable:!0,value:function(){var e=Object(c.a)(a.a.mark(function e(){var t;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=xn(ei(h,ri).id),ei(h,ri).revoked=!0,e.prev=2,e.next=5,ei(h,ai).set(t,ei(h,ri),{encrypt:!0});case 5:e.next=10;break;case 7:e.prev=7,e.t0=e.catch(2),console.warn("Unable to mark identity as revoked: ".concat(ei(h,ri).id),e.t0);case 10:return e.prev=10,e.next=13,Nn(ei(h,ii));case 13:e.next=18;break;case 15:e.prev=15,e.t1=e.catch(10),console.warn("Unable to stop OrbitDB replication after identity has been revoked: ".concat(ei(h,ri).id),e.t1);case 18:ei(h,li).dispatch();case 19:case"end":return e.stop()}},e,null,[[2,7],[10,15]])}));return function(){return e.apply(this,arguments)}}()}),ti(this,ri,t),ti(this,ai,n),ti(this,ii,r),ti(this,si,s),ti(this,ci,i),ti(this,ui,u),ti(this,oi,p),ei(this,ci).onCurrentRevoke(ei(this,fi)),ei(this,ci).getCurrent().revokedAt&&!this.isRevoked()&&setTimeout(ei(this,fi),10)}return Object(p.a)(e,[{key:"getId",value:function(){return ei(this,ri).id}},{key:"getDid",value:function(){return ei(this,ri).did}},{key:"getAddedAt",value:function(){return ei(this,ri).addedAt}},{key:"isRevoked",value:function(){return ei(this,ri).revoked}},{key:"onRevoke",value:function(e){return ei(this,li).add(e)}},{key:"getSigner",value:function(){if(this.isRevoked())throw new ie("Unable to create signer for revoked identity: ".concat(this.getIdentityId()));return ei(this,pi)||ti(this,pi,ei(this,hi).call(this)),ei(this,pi)}},{key:"backup",get:function(){return ei(this,si)}},{key:"devices",get:function(){return ei(this,ci)}},{key:"profile",get:function(){return ei(this,ui)}},{key:"apps",get:function(){return ei(this,oi)}}]),e}(),ri=new WeakMap,ai=new WeakMap,ii=new WeakMap,ci=new WeakMap,si=new WeakMap,ui=new WeakMap,oi=new WeakMap,pi=new WeakMap,li=new WeakMap,hi=new WeakMap,fi=new WeakMap,vi=function(){var e=Object(c.a)(a.a.mark(function e(t,n){var r,i,c;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,D(t,!0);case 2:return r=e.sent,i={id:r,did:t,addedAt:Date.now(),revoked:!1},e.next=6,_n(r,n);case 6:return c=e.sent,e.abrupt("return",Ia(i,n,c));case 8:case"end":return e.stop()}},e)}));return function(t,n){return e.apply(this,arguments)}}(),di=function(){var e=Object(c.a)(a.a.mark(function e(t,n,r,i){var c,s,u,o,p,l,h,f,v,d,w;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return c=t.did,s=t.currentDevice,u=t.backupData,o=t.profileDetails,e.next=3,D(c,!0);case 3:return p=e.sent,l={id:p,did:c,addedAt:Date.now(),revoked:!1},e.next=7,_n(p,i);case 7:return h=e.sent,e.prev=8,e.next=11,n.set(xn(p),l,{encrypt:!0});case 11:return e.next=13,Pr(u,l,n);case 13:return f=e.sent,e.next=16,Da(o,l,i,h);case 16:return v=e.sent,e.next=19,Er(s,l,r,n,h);case 19:return d=e.sent,e.next=22,Za(s.id,l,h);case 22:return w=e.sent,e.abrupt("return",new ni(l,n,h,d,f,v,w));case 26:return e.prev=26,e.t0=e.catch(8),e.next=30,wi(p,n,h);case 30:throw e.t0;case 31:case"end":return e.stop()}},e,null,[[8,26]])}));return function(t,n,r,a){return e.apply(this,arguments)}}(),wi=function(){var e=Object(c.a)(a.a.mark(function e(t,n,r){var i,c,s;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return i=xn(t),e.next=3,n.get(i);case 3:if(c=e.sent){e.next=6;break}return e.abrupt("return");case 6:return e.next=8,n.remove(i);case 8:return e.next=10,_n(c.id,r,{replicate:!1});case 10:return s=e.sent,e.next=13,Tr(c,n,s);case 13:return e.next=15,Sa(c,r,s);case 15:return e.next=17,Nr(c,n);case 17:return e.next=19,$a(c,s);case 19:return e.next=21,Pn(s);case 21:case"end":return e.stop()}},e)}));return function(t,n,r){return e.apply(this,arguments)}}(),bi=function(){var e=Object(c.a)(a.a.mark(function e(t,n,r){var i;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.list({gte:On,lte:"".concat(On,"\xff"),keys:!1});case 2:return i=e.sent,e.abrupt("return",yn()(i,function(){var e=Object(c.a)(a.a.mark(function e(i,c){var s,u,o,p,l,h;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,_n(c.id,r,{replicate:!c.revoked});case 2:return s=e.sent,e.next=5,Rr(c,t);case 5:return u=e.sent,e.next=8,Wa(c,r,s);case 8:return o=e.sent,e.next=11,Mr(c,n,t,s);case 11:return p=e.sent,e.next=14,Za(p.getCurrent().id,c,s);case 14:return l=e.sent,h=new ni(c,t,s,p,u,o,l),e.abrupt("return",Object.assign(i,Object(wn.a)({},c.id,h)));case 17:case"end":return e.stop()}},e)}));return function(t,n){return e.apply(this,arguments)}}(),{}));case 4:case"end":return e.stop()}},e)}));return function(t,n,r){return e.apply(this,arguments)}}();function yi(e,t){if(!t.has(e))throw new TypeError("attempted to get private field on non-instance");var n=t.get(e);return n.get?n.get.call(e):n.value}function ki(e,t,n){if(!t.has(e))throw new TypeError("attempted to set private field on non-instance");var r=t.get(e);if(r.set)r.set.call(e,n);else{if(!r.writable)throw new TypeError("attempted to set read only private field");r.value=n}return n}var Oi=function(){function e(t,n,r){var a=this;Object(o.a)(this,e),xi.set(this,{writable:!0,value:void 0}),gi.set(this,{writable:!0,value:void 0}),mi.set(this,{writable:!0,value:void 0}),ji.set(this,{writable:!0,value:void 0}),Ei.set(this,{writable:!0,value:void 0}),Mi.set(this,{writable:!0,value:void 0}),Ti.set(this,{writable:!0,value:Object(l.a)()}),Ai.set(this,{writable:!0,value:Object(l.a)()}),Ii.set(this,{writable:!0,value:function(e){return yi(a,ji).find(function(t){return t.getDid()===e})}}),Di.set(this,{writable:!0,value:function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];n.forEach(function(t){if(!yi(a,gi).isSupported(e,t))throw new G(e,t)})}}),Wi.set(this,{writable:!0,value:function(){ki(a,ji,Object.values(yi(a,Ei))),yi(a,ji).sort(function(e,t){return e.getAddedAt()-t.getAddedAt()})}}),Si.set(this,{writable:!0,value:function(e){yi(a,Wi).call(a),yi(a,Ti).dispatch(yi(a,ji),e)}}),ki(this,xi,t),ki(this,gi,n),ki(this,mi,r)}return Object(p.a)(e,[{key:"isLoaded",value:function(){return!!yi(this,Ei)}},{key:"load",value:function(){var e=Object(c.a)(a.a.mark(function e(){var t;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=!1,yi(this,Mi)||(ki(this,Mi,bi(yi(this,xi),yi(this,gi),yi(this,mi))),t=!this.isLoaded()),e.prev=2,e.t0=ki,e.t1=this,e.t2=Ei,e.next=8,yi(this,Mi);case 8:e.t3=e.sent,(0,e.t0)(e.t1,e.t2,e.t3),e.next=16;break;case 12:throw e.prev=12,e.t4=e.catch(2),ki(this,Mi,void 0),e.t4;case 16:return yi(this,Wi).call(this),t&&yi(this,Ai).dispatch(yi(this,ji)),e.abrupt("return",yi(this,ji));case 19:case"end":return e.stop()}},e,this,[[2,12]])}));return function(){return e.apply(this,arguments)}}()},{key:"has",value:function(e){return Boolean(yi(this,Ei)[e])}},{key:"get",value:function(e){if(!yi(this,Ei))throw new ce;if(!yi(this,Ei)[e])throw new se(e);return yi(this,Ei)[e]}},{key:"list",value:function(){if(!yi(this,Ei))throw new ce;return yi(this,ji)}},{key:"peek",value:function(){var e=Object(c.a)(a.a.mark(function e(t,n){var r,i,c,s;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return yi(this,Di).call(this,t,"getDid","resolve"),e.next=3,this.load();case 3:return e.next=5,yi(this,gi).getDid(t,n);case 5:return r=e.sent,e.next=8,yi(this,gi).resolve(r);case 8:if(i=e.sent,!(c=yi(this,Ii).call(this,r))){e.next=14;break}e.t0=c.profile.getDetails(),e.next=17;break;case 14:return e.next=16,vi(r,yi(this,mi));case 16:e.t0=e.sent;case 17:return s=e.t0,e.abrupt("return",{did:r,didDocument:i,profileDetails:s});case 19:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}()},{key:"create",value:function(){var e=Object(c.a)(a.a.mark(function e(t,n){var r,i,c,s,u,o,p,l,h,f;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return i=(r=n||{}).profileDetails,c=r.deviceInfo,yi(this,Di).call(this,t,"create"),ur(i),er(c),e.next=6,this.load();case 6:return e.next=8,jr(c);case 8:return s=e.sent,u=s.currentDevice,o=s.didPublicKey,e.next=13,yi(this,gi).create(t,n,function(e){e.addPublicKey(o),e.addAuthentication(o.id)});case 13:return p=e.sent,l=p.did,h=p.backupData,e.next=18,di({did:l,currentDevice:u,backupData:h,profileDetails:i},yi(this,xi),yi(this,gi),yi(this,mi));case 18:return f=e.sent,yi(this,Ei)[f.getId()]=f,yi(this,Si).call(this,{type:"create",id:f.getId()}),e.abrupt("return",f);case 22:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}()},{key:"import",value:function(){var e=Object(c.a)(a.a.mark(function e(t,n){var r,i,c,s,u,o;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=(n||{}).deviceInfo,yi(this,Di).call(this,t,"getDid","update"),er(r),e.next=5,this.load();case 5:return e.next=7,yi(this,gi).getDid(t,n);case 7:if(i=e.sent,!yi(this,Ii).call(this,i)){e.next=10;break}throw new ue(i);case 10:return e.next=12,jr(r);case 12:return c=e.sent,s=c.currentDevice,u=c.didPublicKey,e.next=17,yi(this,gi).update(i,n,function(e){e.addPublicKey(u),e.addAuthentication(u.id)});case 17:return e.next=19,di({did:i,currentDevice:s},yi(this,xi),yi(this,gi),yi(this,mi));case 19:return o=e.sent,yi(this,Ei)[o.getId()]=o,yi(this,Si).call(this,{type:"import",id:o.getId()}),e.abrupt("return",o);case 23:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}()},{key:"remove",value:function(){var e=Object(c.a)(a.a.mark(function e(t,n){var r,i,c;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.load();case 2:if((r=this.get(t)).isRevoked()){e.next=9;break}return i=r.getDid(),c=Ge(i).method,yi(this,Di).call(this,c,"update"),e.next=9,yi(this,gi).update(i,n,function(e){e.revokePublicKey(r.devices.getCurrent().didPublicKeyId)});case 9:return e.next=11,wi(t,yi(this,xi),yi(this,mi));case 11:delete yi(this,Ei)[t],yi(this,Si).call(this,{type:"remove",id:t});case 13:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}()},{key:"onChange",value:function(e){return yi(this,Ti).add(e)}},{key:"onLoad",value:function(e){return yi(this,Ai).add(e)}}]),e}(),xi=new WeakMap,gi=new WeakMap,mi=new WeakMap,ji=new WeakMap,Ei=new WeakMap,Mi=new WeakMap,Ti=new WeakMap,Ai=new WeakMap,Ii=new WeakMap,Di=new WeakMap,Wi=new WeakMap,Si=new WeakMap,_i=function(e,t,n){return new Oi(e,t,n)},Pi=n(2862),Ri=n.n(Pi),Ni=function(e){return"".concat("session!").concat(e)},Ci=function(e){if(e&&!rr()(e))throw new be};function Ki(e,t){if(!t.has(e))throw new TypeError("attempted to get private field on non-instance");var n=t.get(e);return n.get?n.get.call(e):n.value}function Li(e,t,n){if(!t.has(e))throw new TypeError("attempted to set private field on non-instance");var r=t.get(e);if(r.set)r.set.call(e,n);else{if(!r.writable)throw new TypeError("attempted to set read only private field");r.value=n}return n}var Ui=function(){function e(t){var n=this;Object(o.a)(this,e),Vi.set(this,{writable:!0,value:void 0}),Yi.set(this,{writable:!0,value:void 0}),Bi.set(this,{writable:!0,value:function(){var e=n.getKeyMaterial(),t=e.privateKeyPem,r=e.keyPath,a=Je({did:n.getIdentityDid(),fragment:n.getDidPublicKeyId()});return Object(kn.a)(a,t,r)}}),Li(this,Vi,t)}return Object(p.a)(e,[{key:"getId",value:function(){return Ki(this,Vi).id}},{key:"getAppId",value:function(){return Ki(this,Vi).appId}},{key:"getIdentityId",value:function(){return Ki(this,Vi).identityId}},{key:"getIdentityDid",value:function(){return Ki(this,Vi).identityDid}},{key:"getCreatedAt",value:function(){return Ki(this,Vi).createAt}},{key:"getDidPublicKeyId",value:function(){return Ki(this,Vi).didPublicKeyId}},{key:"getKeyMaterial",value:function(){return Ki(this,Vi).keyMaterial}},{key:"getMeta",value:function(){return Ki(this,Vi).meta}},{key:"isValid",value:function(){return Ki(this,Vi).expiresAt>Date.now()}},{key:"getSigner",value:function(){return Ki(this,Yi)||Li(this,Yi,Ki(this,Bi).call(this)),Ki(this,Yi)}}]),e}(),Vi=new WeakMap,Yi=new WeakMap,Bi=new WeakMap,Hi=function(){var e=Object(c.a)(a.a.mark(function e(t,n,r,c){var s,u,o;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=Object(i.a)({maxAge:7776e6},r),s=t.devices.getCurrent(),u=H(s.keyMaterial.privateExtendedKeyBase58),o={id:Ri()("1234567890abcdef",32),identityId:t.getId(),identityDid:t.getDid(),appId:n.id,createAt:Date.now(),expiresAt:Date.now()+r.maxAge,didPublicKeyId:s.didPublicKeyId,keyMaterial:u,meta:r.meta},e.next=6,c.set(Ni(o.id),o);case 6:return e.abrupt("return",new Ui(o));case 7:case"end":return e.stop()}},e)}));return function(t,n,r,a){return e.apply(this,arguments)}}(),Fi=function(){var e=Object(c.a)(a.a.mark(function e(t,n){var r;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=Ni(t),e.next=3,n.get(r);case 3:if(e.sent){e.next=6;break}return e.abrupt("return");case 6:return e.next=8,n.remove(r);case 8:case"end":return e.stop()}},e)}));return function(t,n){return e.apply(this,arguments)}}(),Gi=function(){var e=Object(c.a)(a.a.mark(function e(t){var n,r;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.list({gte:"session!",lte:"".concat("session!","\xff"),keys:!1});case 2:return n=e.sent,r=n.map(function(e){return new Ui(e)}),e.abrupt("return",r.reduce(function(e,n){var r=n.getId();return n.isValid()?e[r]=n:t.remove(Ni(r)).catch(function(e){return console.warn('Unable to remove expired session with id "'.concat(r,'".  Will retry on reload.'),e)}),e},{}));case 5:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}();function Ji(e,t){if(!t.has(e))throw new TypeError("attempted to get private field on non-instance");var n=t.get(e);return n.get?n.get.call(e):n.value}function Xi(e,t,n){if(!t.has(e))throw new TypeError("attempted to set private field on non-instance");var r=t.get(e);if(r.set)r.set.call(e,n);else{if(!r.writable)throw new TypeError("attempted to set read only private field");r.value=n}return n}var qi=function(){function e(t,n,r){var i=this;Object(o.a)(this,e),zi.set(this,{writable:!0,value:void 0}),Qi.set(this,{writable:!0,value:void 0}),Zi.set(this,{writable:!0,value:void 0}),$i.set(this,{writable:!0,value:new Map}),ec.set(this,{writable:!0,value:Object(l.a)()}),tc.set(this,{writable:!0,value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Ji(i,zi);return Object.values(n).find(function(n){return n.getAppId()===t&&n.getIdentityId()===e})}}),nc.set(this,{writable:!0,value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Ji(i,zi);return Object.values(t).filter(function(t){return t.getIdentityId()===e})}}),rc.set(this,{writable:!0,value:function(){var e=Object(c.a)(a.a.mark(function e(t){var n;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=Ji(i,nc).call(i,t),e.next=3,Promise.all(n.map(function(e){return i.destroy(e.getId())}));case 3:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()}),ac.set(this,{writable:!0,value:function(e){if(!Ji(i,$i).has(e)){var t=Ji(i,Zi).get(e),n=t.onRevoke(function(){for(var t,n=arguments.length,r=new Array(n),a=0;a<n;a++)r[a]=arguments[a];return(t=Ji(i,uc)).call.apply(t,[i,e].concat(r))}),r=t.apps.onLinkCurrentChange(function(){for(var t,n=arguments.length,r=new Array(n),a=0;a<n;a++)r[a]=arguments[a];return(t=Ji(i,oc)).call.apply(t,[i,e].concat(r))});Ji(i,$i).set(e,{removeRevokeListener:n,removeLinkChangeListener:r})}}}),ic.set(this,{writable:!0,value:function(e){if(Ji(i,$i).has(e)){var t=Ji(i,$i).get(e);t.removeRevokeListener(),t.removeLinkChangeListener(),Ji(i,$i).delete(e)}}}),cc.set(this,{writable:!0,value:function(){Object.values(Ji(i,Zi).list()).forEach(function(e){var t=e.apps.list(),n=e.getId();t.forEach(function(t){Ji(i,tc).call(i,n,t.id)||e.apps.unlinkCurrentDevice(t.id).catch(function(e){return console.warn('Something went wrong unlinking current device with app "'.concat(t.id,'" for identity "').concat(n,'". Will retry on reload.'),e)})}),Ji(i,ac).call(i,e.getId())}),Object.values(Ji(i,zi)).forEach(function(e){var t=e.getId(),n=e.getIdentityId();Ji(i,Zi).has(n)&&!Ji(i,Zi).get(n).isRevoked()||i.destroy(t).catch(function(e){return console.warn('Something went wrong destroying session "'.concat(t,'" for identity "').concat(n,'". Will retry on reload.'),e)})})}}),sc.set(this,{writable:!0,value:function(){var e=Object(c.a)(a.a.mark(function e(t,n){var r,c;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r=n.type,c=n.id,"remove"===r){e.next=4;break}return Ji(i,ac).call(i,c),e.abrupt("return");case 4:return e.prev=4,e.next=7,Ji(i,rc).call(i,c);case 7:Ji(i,ic).call(i,c),e.next=13;break;case 10:e.prev=10,e.t0=e.catch(4),console.warn('Something went wrong destroying sessions for removed identity "'.concat(c,'". Will retry on reload.'));case 13:case"end":return e.stop()}},e,null,[[4,10]])}));return function(t,n){return e.apply(this,arguments)}}()}),uc.set(this,{writable:!0,value:function(){var e=Object(c.a)(a.a.mark(function e(t){return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,Ji(i,rc).call(i,t);case 3:e.next=8;break;case 5:e.prev=5,e.t0=e.catch(0),console.warn('Something went wrong destroying sessions for revoked identity "'.concat(t,'". Will retry on reload.'));case 8:case"end":return e.stop()}},e,null,[[0,5]])}));return function(t){return e.apply(this,arguments)}}()}),oc.set(this,{writable:!0,value:function(){var e=Object(c.a)(a.a.mark(function e(t,n){var r,c,s,u;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r=n.appId,c=n.isLinked,!(s=Ji(i,tc).call(i,t,r))||c){e.next=14;break}return u=s.getId(),e.prev=4,e.next=7,i.destroy(s.getId());case 7:e.next=12;break;case 9:e.prev=9,e.t0=e.catch(4),console.warn('Something went wrong destroying session "'.concat(u,'" for app "').concat(r,'" of identity "').concat(t,'" . Will retry on reload.'));case 12:e.next=15;break;case 14:!s&&c&&console.warn('App "'.concat(r,'" of identity "').concat(t,"\" is linked but there's no session. Will fix on reload."));case 15:case"end":return e.stop()}},e,null,[[4,9]])}));return function(t,n){return e.apply(this,arguments)}}()}),Xi(this,zi,t),Xi(this,Qi,n),Xi(this,Zi,r),Ji(this,Zi).onLoad(Ji(this,cc)),Ji(this,Zi).onChange(Ji(this,sc))}return Object(p.a)(e,[{key:"get",value:function(e){var t=Ji(this,zi)[e];if(!t||!t.isValid(e))throw new ye(e);return t}},{key:"isValid",value:function(e){var t=Ji(this,zi)[e];return Boolean(t&&t.isValid())}},{key:"create",value:function(){var e=Object(c.a)(a.a.mark(function e(t,n,r){var i,c,s,u;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(zn(n),Ci(r),!(i=Ji(this,Zi).get(t)).isRevoked()){e.next=5;break}throw new ie("Unable to create session for revoked identity: ".concat(t));case 5:if(!(c=Ji(this,tc).call(this,t,n.id))){e.next=11;break}if(!c.isValid()){e.next=9;break}return e.abrupt("return",c);case 9:return e.next=11,this.destroy(c.getId());case 11:return e.next=13,Hi(i,n,r,Ji(this,Qi),Ji(this,Zi));case 13:return s=e.sent,u=s.getId(),Ji(this,zi)[u]=s,e.prev=16,e.next=19,i.apps.add(n);case 19:return e.next=21,i.apps.linkCurrentDevice(n.id);case 21:e.next=35;break;case 23:return e.prev=23,e.t0=e.catch(16),delete Ji(this,zi)[u],e.prev=26,e.next=29,Fi(u,Ji(this,Qi)).catch(function(){});case 29:e.next=34;break;case 31:e.prev=31,e.t1=e.catch(26),console.warn('Unable to remove session "'.concat(u,'" after failed attempt to create app "').concat(n.id,'" or link it to "').concat(t,'". Will cleanup on when identities got loaded again.'),e.t1);case 34:throw e.t0;case 35:return e.abrupt("return",s);case 36:case"end":return e.stop()}},e,this,[[16,23],[26,31]])}));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"destroy",value:function(){var e=Object(c.a)(a.a.mark(function e(t){var n,r,i,c;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=Ji(this,zi)[t]){e.next=3;break}return e.abrupt("return");case 3:return e.next=5,Fi(t,Ji(this,Qi));case 5:if(delete Ji(this,zi)[t],r=n.getAppId(),i=n.getIdentityId(),!Ji(this,Zi).isLoaded()||!Ji(this,Zi).has(i)){e.next=18;break}return c=Ji(this,Zi).get(i),e.prev=10,e.next=13,c.apps.unlinkCurrentDevice(r);case 13:e.next=18;break;case 15:e.prev=15,e.t0=e.catch(10),console.warn('Something went wrong unlinking current device with app "'.concat(r,'" for identity "').concat(i,'". Will retry on reload.'),e.t0);case 18:Ji(this,ec).dispatch(t,n.getMeta());case 19:case"end":return e.stop()}},e,this,[[10,15]])}));return function(t){return e.apply(this,arguments)}}()},{key:"onDestroy",value:function(e){return Ji(this,ec).add(e)}}]),e}(),zi=new WeakMap,Qi=new WeakMap,Zi=new WeakMap,$i=new WeakMap,ec=new WeakMap,tc=new WeakMap,nc=new WeakMap,rc=new WeakMap,ac=new WeakMap,ic=new WeakMap,cc=new WeakMap,sc=new WeakMap,uc=new WeakMap,oc=new WeakMap,pc=function(){var e=Object(c.a)(a.a.mark(function e(t,n){var r;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Gi(t);case 2:return r=e.sent,e.abrupt("return",new qi(r,t,n));case 4:case"end":return e.stop()}},e)}));return function(t,n){return e.apply(this,arguments)}}(),lc=function(e){if(e){if("function"===typeof e.isOnline&&!e.isOnline())throw new ke;return e}return new Promise(function(e,t){var n=new u.a({pass:"K52XQ7K0FPR1DF01RM0L",EXPERIMENTAL:{pubsub:!0},config:{Addresses:{Swarm:["/dns4/ws-star.discovery.libp2p.io/tcp/443/wss/p2p-websocket-star"]}}});n.on("ready",function(){return e(n)}),n.on("error",function(e){return t(e)})})},hc=function(){var e=Object(c.a)(a.a.mark(function e(t){var n,r,c,s,u,o,p,l;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=Object(i.a)({ipfs:void 0},t),e.next=3,lc(t.ipfs);case 3:return n=e.sent,r=Ae(),c=Ze(n),e.next=8,dt(r);case 8:return s=e.sent,e.next=11,dn(s,r);case 11:return u=e.sent,o=_i(s,c,n),e.next=15,pc(s,o);case 15:return p=e.sent,l={ipfs:n,didm:c,storage:s,locker:u,identities:o,sessions:p},e.abrupt("return",l);case 19:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}();t.default=hc}}]);
//# sourceMappingURL=idm-wallet.544e08cd.chunk.js.map